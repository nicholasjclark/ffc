<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Modeling Mortality Trends with Functional Forecasting • ffc</title>
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Modeling Mortality Trends with Functional Forecasting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ffc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/mortality-analysis.html">Modeling Mortality Trends with Functional Forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/elnino-forecasting.html">Forecasting El Niño Patterns with Cyclic Splines and Dynamic Factor Models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nicholasjclark/ffc" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Modeling Mortality Trends with Functional Forecasting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nicholasjclark/ffc/blob/main/vignettes/mortality-analysis.Rmd" class="external-link"><code>vignettes/mortality-analysis.Rmd</code></a></small>
      <div class="d-none name"><code>mortality-analysis.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nicholasjclark.github.io/ffc">ffc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marginaleffects.com/" class="external-link">marginaleffects</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Mortality patterns represent one of the most fundamental demographic
processes, yet traditional statistical approaches often miss the
complex, evolving functional relationships between age and death rates
over time. This vignette demonstrates how functional forecasting using
the <code>ffc</code> package captures these dynamic relationships that
change shape—not just magnitude—over time.</p>
<div class="section level3">
<h3 id="what-makes-mortality-data-ideal-for-functional-forecasting">What makes mortality data ideal for functional forecasting?<a class="anchor" aria-label="anchor" href="#what-makes-mortality-data-ideal-for-functional-forecasting"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Complex age patterns: Mortality exhibits characteristic J-shaped
curves across age groups</li>
<li>Temporal evolution: These functional relationships shift
systematically over time<br>
</li>
<li>Smooth transitions: Changes occur gradually, making them suitable
for GAM-based smoothing</li>
<li>Forecasting relevance: Understanding future mortality trends has
critical policy implications</li>
</ol>
</div>
<div class="section level3">
<h3 id="key-concepts-well-explore">Key concepts we’ll explore<a class="anchor" aria-label="anchor" href="#key-concepts-well-explore"></a>
</h3>
<ul>
<li>Time-varying coefficients: How functional relationships evolve over
time</li>
<li>Hierarchical smoothing: Modeling shared trends with group-specific
deviations<br>
</li>
<li>Functional forecasting: Predicting entire curves into the
future</li>
<li>Model diagnostics: Validating functional time series models</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="data-exploration">Data exploration<a class="anchor" aria-label="anchor" href="#data-exploration"></a>
</h2>
<p>We’ll use Queensland mortality data spanning 1980-2020, containing
death counts by age, sex, and year with corresponding population
denominators.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"qld_mortality"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">qld_mortality</span>, <span class="fl">15</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tsibble: 15 x 5 [1Y]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Key:       age, sex [1]</span></span></span>
<span><span class="co">#&gt;     year   age sex    deaths population</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">1</span>980     0 female    190     <span style="text-decoration: underline;">17</span>700.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">1</span>981     0 female    175     <span style="text-decoration: underline;">18</span>785.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">1</span>982     0 female    190     <span style="text-decoration: underline;">19</span>698.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">1</span>983     0 female    165     <span style="text-decoration: underline;">19</span>908.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">1</span>984     0 female    148     <span style="text-decoration: underline;">19</span>573.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">1</span>985     0 female    164     <span style="text-decoration: underline;">19</span>458.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">1</span>986     0 female    147     <span style="text-decoration: underline;">19</span>405.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">1</span>987     0 female    159     <span style="text-decoration: underline;">19</span>421.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">1</span>988     0 female    153     <span style="text-decoration: underline;">19</span>841.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">1</span>989     0 female    184     <span style="text-decoration: underline;">20</span>942.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>  <span style="text-decoration: underline;">1</span>990     0 female    155     <span style="text-decoration: underline;">21</span>841.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>  <span style="text-decoration: underline;">1</span>991     0 female    143     <span style="text-decoration: underline;">22</span>187.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>  <span style="text-decoration: underline;">1</span>992     0 female    154     <span style="text-decoration: underline;">22</span>314.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>  <span style="text-decoration: underline;">1</span>993     0 female    149     <span style="text-decoration: underline;">22</span>581.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>  <span style="text-decoration: underline;">1</span>994     0 female    109     <span style="text-decoration: underline;">22</span>859.</span></span></code></pre></div>
<p>The dataset structure is ideal for functional analysis: we have a
functional predictor (age) whose relationship with the outcome
(mortality) changes over time (year), with hierarchical structure
(sex).</p>
<div class="section level3">
<h3 id="visualizing-mortality-patterns">Visualizing mortality patterns<a class="anchor" aria-label="anchor" href="#visualizing-mortality-patterns"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">qld_mortality</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">age</span>,</span>
<span>    y <span class="op">=</span> <span class="va">deaths</span> <span class="op">/</span> <span class="va">population</span>,</span>
<span>    group <span class="op">=</span> <span class="va">year</span>,</span>
<span>    colour <span class="op">=</span> <span class="va">year</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_c</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Age"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Mortality rate"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Queensland mortality patterns over time"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="mortality-analysis_files/figure-html/mortality-curves-1.png" class="r-plt" alt="Observed mortality rates by age in Queensland, 1980-2020. The characteristic J-shaped curves show systematic downward shifts over time, indicating mortality improvements across all age groups." width="672"><p class="caption">
Observed mortality rates by age in Queensland, 1980-2020. The
characteristic J-shaped curves show systematic downward shifts over
time, indicating mortality improvements across all age groups.
</p>
</div>
<p>Key observations:</p>
<ul>
<li>J-shaped curves: High infant mortality, low childhood mortality,
exponential increase with age</li>
<li>Temporal shifts: Consistent downward movement of entire curves over
time<br>
</li>
<li>Sex differences: Males consistently higher mortality, similar
temporal patterns</li>
<li>Functional evolution: The shape itself evolves, not just vertical
shifts</li>
<li>Overall decline: Mortality rates have declined substantially across
all ages, reflecting major improvements in healthcare, lifestyle, and
living conditions</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="functional-modeling-approach">Functional modeling approach<a class="anchor" aria-label="anchor" href="#functional-modeling-approach"></a>
</h2>
<div class="section level3">
<h3 id="why-traditional-models-fall-short">Why traditional models fall short<a class="anchor" aria-label="anchor" href="#why-traditional-models-fall-short"></a>
</h3>
<p>Standard approaches might model this as:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Traditional approach - misses functional evolution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">deaths</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="va">sex</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>, offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This assumes linear age effects and additive time trends—clearly
inadequate for evolving functional relationships.</p>
</div>
<div class="section level3">
<h3 id="the-ffc-solution-time-varying-coefficients">The ffc solution: time-varying coefficients<a class="anchor" aria-label="anchor" href="#the-ffc-solution-time-varying-coefficients"></a>
</h3>
<p>The <code><a href="../reference/fts.html">fts()</a></code> function creates basis functions whose
coefficients evolve over time, capturing how the age-mortality
relationship changes:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ffc_gam.html">ffc_gam</a></span><span class="op">(</span></span>
<span>  <span class="va">deaths</span> <span class="op">~</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">sex</span> <span class="op">+</span></span>
<span>    <span class="va">age</span> <span class="op">+</span></span>
<span>    <span class="co"># Time-varying level: shared temporal trends</span></span>
<span>    <span class="fu"><a href="../reference/fts.html">fts</a></span><span class="op">(</span></span>
<span>      <span class="va">year</span>,</span>
<span>      mean_only <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      bs <span class="op">=</span> <span class="st">"tp"</span>,</span>
<span>      time_k <span class="op">=</span> <span class="fl">35</span>,</span>
<span>      time_m <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># Time-varying age effects: sex-specific deviations</span></span>
<span>    <span class="fu"><a href="../reference/fts.html">fts</a></span><span class="op">(</span></span>
<span>      <span class="va">age</span>,</span>
<span>      by <span class="op">=</span> <span class="va">sex</span>,</span>
<span>      bs <span class="op">=</span> <span class="st">"tp"</span>, </span>
<span>      time_k <span class="op">=</span> <span class="fl">15</span>,</span>
<span>      time_m <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">qld_mortality</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="co"># Efficient for large datasets</span></span>
<span>  engine <span class="op">=</span> <span class="st">"bam"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="understanding-the-model-structure">Understanding the model structure<a class="anchor" aria-label="anchor" href="#understanding-the-model-structure"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: poisson </span></span>
<span><span class="co">#&gt; Link function: log </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; deaths ~ sex + age + offset(log(population)) + s(year, by = fts_year1_mean, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 35, m = 1, id = 1) + s(year, by = fts_bs_s_age_bysexfemale_1, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexfemale_2, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexfemale_3, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexfemale_4, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexfemale_5, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexfemale_6, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexfemale_7, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexfemale_8, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexfemale_9, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexmale_1, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexmale_2, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexmale_3, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexmale_4, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexmale_5, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexmale_6, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexmale_7, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexmale_8, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2) + s(year, by = fts_bs_s_age_bysexmale_9, </span></span>
<span><span class="co">#&gt;     bs = "ts", k = 15, m = 1, id = 2)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parametric coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)  3.371181   2.488125   1.355 0.175447    </span></span>
<span><span class="co">#&gt; sexmale      0.574306   0.004986 115.189  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; age         -0.180386   0.049764  -3.625 0.000289 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Approximate significance of smooth terms:</span></span>
<span><span class="co">#&gt;                                       edf Ref.df   Chi.sq p-value    </span></span>
<span><span class="co">#&gt; s(year):fts_year1_mean             32.048     34 10329.34  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexfemale_1 14.470     15 11934.09  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexfemale_2 12.621     15  9711.83  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexfemale_3 14.477     15    68.77  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexfemale_4 13.307     15  7609.29  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexfemale_5 14.505     15   498.50  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexfemale_6 13.147     15  7787.91  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexfemale_7 14.265     15   712.25  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexfemale_8  9.615     15 11101.16  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexfemale_9 11.815     15    39.30  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexmale_1   14.347     15  7385.09  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexmale_2   12.758     15  9625.52  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexmale_3   14.606     15   106.51  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexmale_4   13.620     15  9829.84  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexmale_5   14.601     15  1741.23  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexmale_6   13.601     15  9939.09  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexmale_7   14.438     15   308.23  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexmale_8    9.738     15 12228.38  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(year):fts_bs_s_age_bysexmale_9   11.218     15    72.68  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; R-sq.(adj) =  0.986   Deviance explained = 97.6%</span></span>
<span><span class="co">#&gt; fREML =  22150  Scale est. = 1         n = 8282</span></span></code></pre></div>
<p>Key components:</p>
<ol style="list-style-type: decimal">
<li>Fixed effects: <code>sex</code> captures baseline male-female
differences, <code>age</code> captures baseline mortality rates per
age</li>
<li>Time-varying level: <code>fts(year, mean_only = TRUE)</code> models
shared temporal trends<br>
</li>
<li>Time-varying functions: <code>fts(age, by = sex)</code> captures how
age patterns evolve differently by sex</li>
</ol>
<p>The model automatically creates a hierarchical structure where basis
functions become <code>by</code> variables in smooths of time, sharing
smoothing parameters for computational efficiency.</p>
</div>
</div>
<div class="section level2">
<h2 id="model-interpretation">Model interpretation<a class="anchor" aria-label="anchor" href="#model-interpretation"></a>
</h2>
<div class="section level3">
<h3 id="predicted-functional-curves">Predicted functional curves<a class="anchor" aria-label="anchor" href="#predicted-functional-curves"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newdat</span> <span class="op">&lt;-</span> <span class="va">qld_mortality</span></span>
<span><span class="va">newdat</span><span class="op">$</span><span class="va">population</span> <span class="op">&lt;-</span> <span class="fl">1</span>  <span class="co"># Standardized predictions</span></span>
<span></span>
<span><span class="va">newdat</span><span class="op">$</span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">mod</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">newdat</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"response"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">newdat</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">age</span>,</span>
<span>    y <span class="op">=</span> <span class="va">preds</span>,</span>
<span>    group <span class="op">=</span> <span class="va">year</span>,</span>
<span>    colour <span class="op">=</span> <span class="va">year</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_c</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Age"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Expected mortality rate"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Model predictions: evolving mortality patterns"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="mortality-analysis_files/figure-html/predicted-curves-1.png" class="r-plt" alt="Model predictions showing expected mortality curves by age and year. Smooth curves demonstrate systematic evolution of the age-mortality relationship over four decades." width="672"><p class="caption">
Model predictions showing expected mortality curves by age and year.
Smooth curves demonstrate systematic evolution of the age-mortality
relationship over four decades.
</p>
</div>
<p>The model successfully captures the smooth evolution of J-shaped
mortality curves while preserving the characteristic functional form.
The downward trend across all mortality curves demonstrates substantial
improvement in survival rates over the 40-year period. This reflects
major advances in healthcare, improved living conditions, better
nutrition, and reduced exposure to environmental hazards. Notably, the
decline is not uniform across all ages - the model captures how the rate
of improvement varies by age group and sex, with some periods showing
more rapid mortality decline than others.</p>
</div>
<div class="section level3">
<h3 id="focused-analysis-teenage-mortality-trends">Focused analysis: teenage mortality trends<a class="anchor" aria-label="anchor" href="#focused-analysis-teenage-mortality-trends"></a>
</h3>
<p>Let’s examine how mortality patterns changed for a specific age group
by leveraging the power of <code>marginaleffects</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/r/plot_predictions.html" class="external-link">plot_predictions</a></span><span class="op">(</span></span>
<span>  <span class="va">mod</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"sex"</span><span class="op">)</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/r/datagrid.html" class="external-link">datagrid</a></span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fl">17</span>,</span>
<span>    year <span class="op">=</span> <span class="va">unique</span>,</span>
<span>    sex <span class="op">=</span> <span class="va">unique</span>,</span>
<span>    population <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"response"</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Expected mortality rate"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Teenage mortality trends over time"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="mortality-analysis_files/figure-html/mortality-trends-1.png" class="r-plt" alt="Predicted mortality trends for 17-year-olds in Queensland, 1980-2020. Shows approximately 70% decline in mortality rates with consistent male-female differences." width="672"><p class="caption">
Predicted mortality trends for 17-year-olds in Queensland, 1980-2020.
Shows approximately 70% decline in mortality rates with consistent
male-female differences.
</p>
</div>
</div>
<div class="section level3">
<h3 id="rate-of-change-analysis">Rate of change analysis<a class="anchor" aria-label="anchor" href="#rate-of-change-analysis"></a>
</h3>
<p>We can look deeper at these predictions to understand <em>how
fast</em> mortality is improving, again using
<code>marginaleffects</code> support:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/r/plot_slopes.html" class="external-link">plot_slopes</a></span><span class="op">(</span></span>
<span>  <span class="va">mod</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"sex"</span><span class="op">)</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/r/datagrid.html" class="external-link">datagrid</a></span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fl">17</span>,</span>
<span>    year <span class="op">=</span> <span class="va">unique</span>,</span>
<span>    sex <span class="op">=</span> <span class="va">unique</span>,</span>
<span>    population <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"response"</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Rate of mortality change"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Speed of mortality improvement over time"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span></span>
<span>    yintercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.7</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="mortality-analysis_files/figure-html/mortality-derivatives-1.png" class="r-plt" alt="First derivatives showing the rate of mortality improvement for 17-year-olds. Fluctuations reveal periods of faster and slower mortality decline." width="672"><p class="caption">
First derivatives showing the rate of mortality improvement for
17-year-olds. Fluctuations reveal periods of faster and slower mortality
decline.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="extracting-time-varying-coefficients">Extracting time-varying coefficients<a class="anchor" aria-label="anchor" href="#extracting-time-varying-coefficients"></a>
</h2>
<p>The power of functional forecasting lies in treating the evolving
coefficients as time series that can be forecasted:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">functional_coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fts_coefs.ffc_gam.html">fts_coefs</a></span><span class="op">(</span></span>
<span>  <span class="va">mod</span>,</span>
<span>  summary <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span><span class="va">functional_coefs</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 19,475 × 6</span></span></span>
<span><span class="co">#&gt;    .basis         .parameter .time .estimate .realisation  year</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> fts_year1_mean location    <span style="text-decoration: underline;">1</span>980     0.356            1  <span style="text-decoration: underline;">1</span>980</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> fts_year1_mean location    <span style="text-decoration: underline;">1</span>981     0.368            1  <span style="text-decoration: underline;">1</span>981</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> fts_year1_mean location    <span style="text-decoration: underline;">1</span>982     0.403            1  <span style="text-decoration: underline;">1</span>982</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> fts_year1_mean location    <span style="text-decoration: underline;">1</span>983     0.319            1  <span style="text-decoration: underline;">1</span>983</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> fts_year1_mean location    <span style="text-decoration: underline;">1</span>984     0.324            1  <span style="text-decoration: underline;">1</span>984</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> fts_year1_mean location    <span style="text-decoration: underline;">1</span>985     0.318            1  <span style="text-decoration: underline;">1</span>985</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> fts_year1_mean location    <span style="text-decoration: underline;">1</span>986     0.259            1  <span style="text-decoration: underline;">1</span>986</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> fts_year1_mean location    <span style="text-decoration: underline;">1</span>987     0.247            1  <span style="text-decoration: underline;">1</span>987</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> fts_year1_mean location    <span style="text-decoration: underline;">1</span>988     0.234            1  <span style="text-decoration: underline;">1</span>988</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> fts_year1_mean location    <span style="text-decoration: underline;">1</span>989     0.265            1  <span style="text-decoration: underline;">1</span>989</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 19,465 more rows</span></span></span></code></pre></div>
<div class="section level3">
<h3 id="visualizing-coefficient-evolution">Visualizing coefficient evolution<a class="anchor" aria-label="anchor" href="#visualizing-coefficient-evolution"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">functional_coefs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Evolution of functional basis coefficients"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="mortality-analysis_files/figure-html/plot-coefficients-1.png" class="r-plt" alt="Time series of functional basis coefficients. Each panel shows how different aspects of the age-mortality relationship evolved over time, revealing complex temporal dependencies." width="672"><p class="caption">
Time series of functional basis coefficients. Each panel shows how
different aspects of the age-mortality relationship evolved over time,
revealing complex temporal dependencies.
</p>
</div>
<p>Interpretation:</p>
<ul>
<li>Complex patterns: Each coefficient series shows distinct temporal
behavior</li>
<li>Smooth evolution: Changes occur gradually, suitable for time series
modeling</li>
<li>Interdependence: Multiple coefficients work together to create the
functional evolution</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="forecasting-mortality-patterns">Forecasting mortality patterns<a class="anchor" aria-label="anchor" href="#forecasting-mortality-patterns"></a>
</h2>
<div class="section level3">
<h3 id="coefficient-forecasting">Coefficient forecasting<a class="anchor" aria-label="anchor" href="#coefficient-forecasting"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">functional_fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">functional_coefs</span>,</span>
<span>  h <span class="op">=</span> <span class="fl">5</span>,      <span class="co"># 5-year horizon</span></span>
<span>  times <span class="op">=</span> <span class="fl">10</span>, <span class="co"># Forecast replicates</span></span>
<span>  model <span class="op">=</span> <span class="st">"ARIMA"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">functional_fc</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tsibble: 59,375 x 6 [1Y]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Key:       .basis, .realisation, .model, .rep [11,875]</span></span></span>
<span><span class="co">#&gt;    .basis                     .realisation .model  year .rep   .sim</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> fts_bs_s_age_bysexfemale_1            1 ARIMA   <span style="text-decoration: underline;">2</span>021 1      1.96</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> fts_bs_s_age_bysexfemale_1            1 ARIMA   <span style="text-decoration: underline;">2</span>022 1      1.92</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> fts_bs_s_age_bysexfemale_1            1 ARIMA   <span style="text-decoration: underline;">2</span>023 1      1.86</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> fts_bs_s_age_bysexfemale_1            1 ARIMA   <span style="text-decoration: underline;">2</span>024 1      1.81</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> fts_bs_s_age_bysexfemale_1            1 ARIMA   <span style="text-decoration: underline;">2</span>025 1      1.78</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> fts_bs_s_age_bysexfemale_1            1 ARIMA   <span style="text-decoration: underline;">2</span>021 10     1.96</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> fts_bs_s_age_bysexfemale_1            1 ARIMA   <span style="text-decoration: underline;">2</span>022 10     1.93</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> fts_bs_s_age_bysexfemale_1            1 ARIMA   <span style="text-decoration: underline;">2</span>023 10     1.88</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> fts_bs_s_age_bysexfemale_1            1 ARIMA   <span style="text-decoration: underline;">2</span>024 10     1.86</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> fts_bs_s_age_bysexfemale_1            1 ARIMA   <span style="text-decoration: underline;">2</span>025 10     1.86</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 59,365 more rows</span></span></span></code></pre></div>
<p>The forecast includes uncertainty in both the time series models and
the original coefficient estimation, providing realistic prediction
intervals.</p>
</div>
<div class="section level3">
<h3 id="future-mortality-patterns">Future mortality patterns<a class="anchor" aria-label="anchor" href="#future-mortality-patterns"></a>
</h3>
<p>Let’s demonstrate how to generate complete mortality curve forecasts
by combining the forecasted coefficients with the model structure. Here
we will use the ensemble model (“ENS”) to forecast the time-varying
mean, which tends to give more robust forecasts than any of the mdoels
on their own:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create forecast data for future years</span></span>
<span><span class="va">future_years</span> <span class="op">&lt;-</span> <span class="fl">2021</span><span class="op">:</span><span class="fl">2025</span></span>
<span><span class="va">newdata_forecast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">qld_mortality</span><span class="op">$</span><span class="va">age</span><span class="op">)</span>,</span>
<span>  sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">qld_mortality</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span>,</span>
<span>  year <span class="op">=</span> <span class="va">future_years</span>,</span>
<span>  population <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate forecasted mortality curves using forecast()</span></span>
<span><span class="co"># This integrates the time series forecasts of coefficients</span></span>
<span><span class="va">mortality_forecasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">mod</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">newdata_forecast</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"ARIMA"</span>,</span>
<span>  mean_model <span class="op">=</span> <span class="st">"ENS"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"expected"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mortality_forecasts</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   .estimate  .error    .q2.5     .q10     .q90   .q97.5</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  0.001<span style="text-decoration: underline;">67</span>  0.001<span style="text-decoration: underline;">61</span> 0.001<span style="text-decoration: underline;">07</span>  0.001<span style="text-decoration: underline;">30</span>  0.002<span style="text-decoration: underline;">36</span>  0.003<span style="text-decoration: underline;">18</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  0.001<span style="text-decoration: underline;">05</span>  0.001<span style="text-decoration: underline;">09</span> 0.000<span style="text-decoration: underline;">683</span> 0.000<span style="text-decoration: underline;">776</span> 0.001<span style="text-decoration: underline;">25</span>  0.002<span style="text-decoration: underline;">04</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  0.000<span style="text-decoration: underline;">665</span> 0.001<span style="text-decoration: underline;">42</span> 0.000<span style="text-decoration: underline;">431</span> 0.000<span style="text-decoration: underline;">512</span> 0.000<span style="text-decoration: underline;">788</span> 0.001<span style="text-decoration: underline;">04</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  0.000<span style="text-decoration: underline;">446</span> 0.002<span style="text-decoration: underline;">26</span> 0.000<span style="text-decoration: underline;">285</span> 0.000<span style="text-decoration: underline;">358</span> 0.000<span style="text-decoration: underline;">558</span> 0.000<span style="text-decoration: underline;">747</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  0.000<span style="text-decoration: underline;">285</span> 0.002<span style="text-decoration: underline;">32</span> 0.000<span style="text-decoration: underline;">190</span> 0.000<span style="text-decoration: underline;">216</span> 0.000<span style="text-decoration: underline;">360</span> 0.000<span style="text-decoration: underline;">428</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  0.000<span style="text-decoration: underline;">194</span> 0.001<span style="text-decoration: underline;">41</span> 0.000<span style="text-decoration: underline;">113</span> 0.000<span style="text-decoration: underline;">144</span> 0.000<span style="text-decoration: underline;">241</span> 0.000<span style="text-decoration: underline;">330</span></span></span>
<span></span>
<span><span class="co"># Plot forecasted mortality rates, together with uncertainties</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mortality_forecasts</span> <span class="op">|&gt;</span></span>
<span>         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">newdata_forecast</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>,</span>
<span>           y <span class="op">=</span> <span class="va">.estimate</span>,</span>
<span>           group <span class="op">=</span> <span class="va">year</span>,</span>
<span>           colour <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    ymin <span class="op">=</span> <span class="va">.q10</span>,</span>
<span>    ymax <span class="op">=</span> <span class="va">.q90</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">year</span></span>
<span>  <span class="op">)</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_c</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Age"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Mortality rate"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Expected mortality"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="mortality-analysis_files/figure-html/forecast-curves-1.png" class="r-plt" alt="Forecasted mortality curves for Queensland, 2021-2025. Shows how the functional forecasting approach predicts future age-mortality patterns." width="672"><p class="caption">
Forecasted mortality curves for Queensland, 2021-2025. Shows how the
functional forecasting approach predicts future age-mortality patterns.
</p>
</div>
<p>This forecasting approach enables prediction of entire functional
relationships by combining time series forecasts of the functional
coefficients with the underlying model structure. We could easily then
convert this to a <code>fable</code> object (using
<code><a href="https://fabletools.tidyverts.org/reference/as-fable.html" class="external-link">as_fable()</a></code>) and compare with holdout data to compute any of
the forecast scores supported by <code>fable</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="key-insights-and-methodology">Key insights and methodology<a class="anchor" aria-label="anchor" href="#key-insights-and-methodology"></a>
</h2>
<div class="section level3">
<h3 id="what-we-learned-about-queensland-mortality">What we learned about Queensland mortality<a class="anchor" aria-label="anchor" href="#what-we-learned-about-queensland-mortality"></a>
</h3>
<ul>
<li>Systematic improvement: Mortality declined across all age groups
over 40 years</li>
<li>Functional evolution: Changes involved curve shape, not just
magnitude shifts</li>
<li>Heterogeneous trends: Rate of improvement varied by age and sex</li>
<li>Complex patterns: Simple parametric models would miss these
relationships</li>
</ul>
</div>
<div class="section level3">
<h3 id="why-functional-forecasting-matters">Why functional forecasting matters<a class="anchor" aria-label="anchor" href="#why-functional-forecasting-matters"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Captures complexity: Models evolving functional relationships
traditional methods miss</li>
<li>Preserves structure: Maintains biological/physical constraints in
forecasts<br>
</li>
<li>Quantifies uncertainty: Propagates uncertainty through the entire
functional evolution</li>
<li>Policy relevance: Enables sophisticated demographic projections</li>
</ol>
</div>
<div class="section level3">
<h3 id="model-design-principles">Model design principles<a class="anchor" aria-label="anchor" href="#model-design-principles"></a>
</h3>
<ul>
<li>Hierarchical structure: Shared trends with group-specific
deviations</li>
<li>Temporal smoothing: Balance flexibility with smoothness using
<code>time_k</code> and <code>time_m</code>
</li>
<li>Basis choice: Thin plate splines work well for age and time</li>
<li>Computational efficiency: <code><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam()</a></code> engine handles large
datasets effectively</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="extensions-and-further-analysis">Extensions and further analysis<a class="anchor" aria-label="anchor" href="#extensions-and-further-analysis"></a>
</h2>
<div class="section level3">
<h3 id="advanced-features">Advanced features<a class="anchor" aria-label="anchor" href="#advanced-features"></a>
</h3>
<p>The <code>ffc</code> package supports additional complexity:<br>
- Multiple functional predictors:
<code>fts(age) + fts(time_since_event)</code><br>
- Interaction effects: Functional relationships that depend on other
variables<br>
- Alternative distributions: Beyond Poisson to handle different data
types</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Functional forecasting with <code>ffc</code> provides a principled
approach to modeling and predicting evolving functional relationships.
By treating time-varying coefficients as forecastable time series, we
can:</p>
<ol style="list-style-type: decimal">
<li>Capture complexity that traditional methods miss</li>
<li>Generate realistic forecasts of entire functional
relationships<br>
</li>
<li>Quantify uncertainty appropriately across all sources</li>
<li>Provide actionable insights for policy and planning</li>
</ol>
<p>The Queensland mortality analysis demonstrates these capabilities in
a real-world context, revealing patterns and trends that inform our
understanding of demographic change and enable sophisticated projection
methods for public health planning.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ecogambler.netlify.app/" class="external-link">Nicholas J Clark</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
