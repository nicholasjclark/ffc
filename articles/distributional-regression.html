<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Distributional Regression for Motorcycle Crash Data with Time-Varying Location and Scale Parameters • ffc</title>
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Distributional Regression for Motorcycle Crash Data with Time-Varying Location and Scale Parameters">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ffc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/mortality-analysis.html">Modeling Mortality Trends with Functional Forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/elnino-forecasting.html">Forecasting El Niño Patterns with Cyclic Splines and Dynamic Factor Models</a></li>
    <li><a class="dropdown-item" href="../articles/distributional-regression.html">Distributional Regression for Motorcycle Crash Data with Time-Varying Location and Scale Parameters</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nicholasjclark/ffc" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Distributional Regression for Motorcycle Crash Data with Time-Varying Location and Scale Parameters</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nicholasjclark/ffc/blob/main/vignettes/distributional-regression.Rmd" class="external-link"><code>vignettes/distributional-regression.Rmd</code></a></small>
      <div class="d-none name"><code>distributional-regression.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nicholasjclark.github.io/ffc">ffc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Motorcycle crash dynamics involve complex patterns where both the
mean acceleration and its variability change dramatically over time
during impact events. Traditional Gaussian regression assumes constant
variance, potentially missing critical safety insights about periods of
extreme or unpredictable forces. This vignette demonstrates how
distributional regression with the <a href="https://github.com/njtierney/ffc" class="external-link"><code>ffc</code></a> package
addresses these challenges through:</p>
<ol style="list-style-type: decimal">
<li>Time-varying location parameters capturing evolving mean
acceleration patterns<br>
</li>
<li>Time-varying scale parameters modeling heteroskedasticity during
impact phases<br>
</li>
<li>Rolling forecast evaluation for robust model validation<br>
</li>
<li>Comprehensive uncertainty quantification for safety
applications</li>
</ol>
<div class="section level3">
<h3 id="the-crash-dynamics-challenge">The crash dynamics challenge<a class="anchor" aria-label="anchor" href="#the-crash-dynamics-challenge"></a>
</h3>
<p>Motorcycle crash acceleration data presents unique modeling
challenges:</p>
<ul>
<li>Non-constant variance during different impact phases<br>
</li>
<li>Complex temporal evolution of both mean and variability<br>
</li>
<li>Need to predict both typical and extreme force scenarios<br>
</li>
<li>Critical safety implications requiring proper uncertainty
bounds</li>
</ul>
</div>
<div class="section level3">
<h3 id="our-approach-distributional-gams-with-functional-coefficients">Our approach: distributional GAMs with functional coefficients<a class="anchor" aria-label="anchor" href="#our-approach-distributional-gams-with-functional-coefficients"></a>
</h3>
<p>The <code>ffc</code> package treats both location and scale as smooth
functions that evolve over time. By combining <a href="https://cran.r-project.org/package=mgcv" class="external-link"><code>mgcv</code></a>
distributional families with functional regression, we can:</p>
<ul>
<li>Model time-varying mean acceleration trends<br>
</li>
<li>Capture evolving variance patterns throughout crash sequences<br>
</li>
<li>Generate probabilistic forecasts with parameter-specific
uncertainty<br>
</li>
<li>Validate predictions using rolling forecast techniques</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="data-exploration">Data exploration<a class="anchor" aria-label="anchor" href="#data-exploration"></a>
</h2>
<p>We’ll use the classic motorcycle crash dataset from <a href="https://cran.r-project.org/package=MASS" class="external-link"><code>MASS</code></a>,
representing head acceleration measurements during simulated motorcycle
crashes:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mcycle</span>, package <span class="op">=</span> <span class="st">"MASS"</span><span class="op">)</span></span>
<span><span class="va">mcycle</span><span class="op">$</span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">mcycle</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check data structure</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">mcycle</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 133</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ times <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.4<span style="color: #949494;">, </span>2.6<span style="color: #949494;">, </span>3.2<span style="color: #949494;">, </span>3.6<span style="color: #949494;">, </span>4.0<span style="color: #949494;">, </span>6.2<span style="color: #949494;">, </span>6.6<span style="color: #949494;">, </span>6.8<span style="color: #949494;">, </span>7.8<span style="color: #949494;">, </span>8.2<span style="color: #949494;">, </span>8.8<span style="color: #949494;">, </span>8.8<span style="color: #949494;">, </span>9.6<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ accel <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.0<span style="color: #949494;">, </span>-1.3<span style="color: #949494;">, </span>-2.7<span style="color: #949494;">, </span>0.0<span style="color: #949494;">, </span>-2.7<span style="color: #949494;">, </span>-2.7<span style="color: #949494;">, </span>-2.7<span style="color: #949494;">, </span>-1.3<span style="color: #949494;">, </span>-2.7<span style="color: #949494;">, </span>-2.7<span style="color: #949494;">, </span>-1.3<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ index <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>3<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>5<span style="color: #949494;">, </span>6<span style="color: #949494;">, </span>7<span style="color: #949494;">, </span>8<span style="color: #949494;">, </span>9<span style="color: #949494;">, </span>10<span style="color: #949494;">, </span>11<span style="color: #949494;">, </span>12<span style="color: #949494;">, </span>13<span style="color: #949494;">, </span>14<span style="color: #949494;">, </span>15<span style="color: #949494;">, </span>16<span style="color: #949494;">, </span>17<span style="color: #949494;">, </span>18<span style="color: #949494;">, </span>1…</span></span></code></pre></div>
<div class="section level3">
<h3 id="visualizing-acceleration-patterns">Visualizing acceleration patterns<a class="anchor" aria-label="anchor" href="#visualizing-acceleration-patterns"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mcycle</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="va">accel</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">110</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"darkred"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Time Index"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Head Acceleration"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Motorcycle crash data: heteroskedastic acceleration patterns"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="distributional-regression_files/figure-html/acceleration-patterns-1.png" class="r-plt" alt="Head acceleration measurements showing clear heteroskedasticity over time." width="672"><p class="caption">
Head acceleration measurements showing clear heteroskedasticity over
time.
</p>
</div>
<p>The data shows low variance before impact, extreme variance during
the crash, and moderate variance in the rebound phase.</p>
</div>
<div class="section level3">
<h3 id="identifying-variance-patterns">Identifying variance patterns<a class="anchor" aria-label="anchor" href="#identifying-variance-patterns"></a>
</h3>
<p>Let’s examine how variance changes across different phases of the
crash sequence:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate moving variance with overlapping windows</span></span>
<span><span class="va">window_size</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span><span class="va">mcycle</span><span class="op">$</span><span class="va">moving_var</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="op">(</span><span class="va">window_size</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mcycle</span><span class="op">)</span> <span class="op">-</span> <span class="va">window_size</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">window_data</span> <span class="op">&lt;-</span> <span class="va">mcycle</span><span class="op">$</span><span class="va">accel</span><span class="op">[</span><span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="va">window_size</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">i</span> <span class="op">+</span> <span class="va">window_size</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">mcycle</span><span class="op">$</span><span class="va">moving_var</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">window_data</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mcycle</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">moving_var</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkred"</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">moving_var</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkred"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Time Index"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Moving variance"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Time-varying variance in motorcycle crash acceleration"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="distributional-regression_files/figure-html/variance-exploration-1.png" class="r-plt" alt="Moving variance reveals dramatic changes in acceleration variability over time." width="672"><p class="caption">
Moving variance reveals dramatic changes in acceleration variability
over time.
</p>
</div>
<p>The moving variance peaks dramatically during the crash phase,
confirming that constant variance assumptions would be inappropriate for
this data.</p>
</div>
</div>
<div class="section level2">
<h2 id="modeling-with-distributional-gams">Modeling with distributional GAMs<a class="anchor" aria-label="anchor" href="#modeling-with-distributional-gams"></a>
</h2>
<div class="section level3">
<h3 id="train-test-split-for-validation">Train-test split for validation<a class="anchor" aria-label="anchor" href="#train-test-split-for-validation"></a>
</h3>
<p>We’ll use early crash data for training and reserve later impact
phases for validation:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcycle_train</span> <span class="op">&lt;-</span> <span class="va">mcycle</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">index</span> <span class="op">&lt;</span> <span class="fl">110</span><span class="op">)</span></span>
<span><span class="va">mcycle_test</span> <span class="op">&lt;-</span> <span class="va">mcycle</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">index</span> <span class="op">&gt;=</span> <span class="fl">110</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-distributional-model-specification">The distributional model specification<a class="anchor" aria-label="anchor" href="#the-distributional-model-specification"></a>
</h3>
<p>Now let’s fit a model that will allow us to forecast changes in both
the mean <em>and</em> the variance. The key innovation is using <a href="https://rdrr.io/cran/mgcv/man/gaulss.html" class="external-link"><code>gaulss()</code></a>
to model both location and scale parameters with functional time
series:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcycle_gaulss_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ffc_gam.html">ffc_gam</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># Location parameter: time-varying mean acceleration  </span></span>
<span>    <span class="va">accel</span> <span class="op">~</span> <span class="fu"><a href="../reference/fts.html">fts</a></span><span class="op">(</span><span class="va">index</span>, mean_only <span class="op">=</span> <span class="cn">TRUE</span>, time_k <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># Scale parameter: time-varying variance</span></span>
<span>    <span class="op">~</span> <span class="fu"><a href="../reference/fts.html">fts</a></span><span class="op">(</span><span class="va">index</span>, mean_only <span class="op">=</span> <span class="cn">TRUE</span>, time_k <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gaulss.html" class="external-link">gaulss</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mcycle_train</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"index"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="understanding-the-model-structure">Understanding the model structure<a class="anchor" aria-label="anchor" href="#understanding-the-model-structure"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mcycle_gaulss_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: gaulss </span></span>
<span><span class="co">#&gt; Link function: identity logb </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; accel ~ s(index, by = location_fts_index1_mean, bs = "ts", k = 25, </span></span>
<span><span class="co">#&gt;     m = 2)</span></span>
<span><span class="co">#&gt; ~s(index, by = scale_fts_index1_mean, bs = "ts", k = 25, m = 2)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parametric coefficients:</span></span>
<span><span class="co">#&gt;                Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)   -31.14284    2.18787  -14.23   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; (Intercept).1   2.55943    0.07069   36.21   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Approximate significance of smooth terms:</span></span>
<span><span class="co">#&gt;                                      edf Ref.df Chi.sq p-value    </span></span>
<span><span class="co">#&gt; s(index):location_fts_index1_mean 10.440     24  627.4  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s.1(index):scale_fts_index1_mean   4.334     24  282.8  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance explained = 99.3%</span></span>
<span><span class="co">#&gt; -REML = 476.13  Scale est. = 1         n = 109</span></span></code></pre></div>
<p>The model decomposes crash dynamics into:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Location parameter</strong>: Smooth time-varying mean
acceleration<br>
</li>
<li>
<strong>Scale parameter</strong>: Time-varying standard deviation
modeling heteroskedasticity</li>
</ol>
<p>The <a href="https://rdrr.io/cran/mgcv/man/gaulss.html" class="external-link"><code>gaulss()</code></a>
family uses log-link for the scale parameter, ensuring positive variance
estimates throughout the crash sequence.</p>
</div>
</div>
<div class="section level2">
<h2 id="model-diagnostics-and-interpretation">Model diagnostics and interpretation<a class="anchor" aria-label="anchor" href="#model-diagnostics-and-interpretation"></a>
</h2>
<div class="section level3">
<h3 id="visualizing-fitted-trends-and-variance">Visualizing fitted trends and variance<a class="anchor" aria-label="anchor" href="#visualizing-fitted-trends-and-variance"></a>
</h3>
<p>We can examine how the model captures both mean trends and changing
variance:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract time-varying coefficients for both parameters</span></span>
<span><span class="va">fts_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fts_coefs.ffc_gam.html">fts_coefs</a></span><span class="op">(</span><span class="va">mcycle_gaulss_model</span>, summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">fts_results</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Time-varying distributional parameters"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Time Index"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Coefficient Value"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="distributional-regression_files/figure-html/fitted-patterns-1.png" class="r-plt" alt="Fitted location and scale parameters reveal distinct temporal patterns in crash dynamics." width="672"><p class="caption">
Fitted location and scale parameters reveal distinct temporal patterns
in crash dynamics.
</p>
</div>
<p>The location parameter captures the mean acceleration trajectory
while the scale parameter adapts to varying uncertainty levels
throughout the crash sequence.</p>
</div>
<div class="section level3">
<h3 id="extracting-parameter-specific-coefficients">Extracting parameter-specific coefficients<a class="anchor" aria-label="anchor" href="#extracting-parameter-specific-coefficients"></a>
</h3>
<p>The functional coefficients reveal the underlying dynamics of each
distributional parameter:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View coefficient structure</span></span>
<span><span class="va">fts_results</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5,450 × 6</span></span></span>
<span><span class="co">#&gt;    .basis                   .parameter .time .estimate .realisation index</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> location_fts_index1_mean location       1      27.8            1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> location_fts_index1_mean location       2      27.2            1     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> location_fts_index1_mean location       3      26.7            1     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> location_fts_index1_mean location       4      26.3            1     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> location_fts_index1_mean location       5      26.2            1     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> location_fts_index1_mean location       6      26.2            1     6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> location_fts_index1_mean location       7      26.1            1     7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> location_fts_index1_mean location       8      26.0            1     8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> location_fts_index1_mean location       9      25.8            1     9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> location_fts_index1_mean location      10      25.4            1    10</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5,440 more rows</span></span></span>
<span></span>
<span><span class="co"># Summary statistics by parameter</span></span>
<span><span class="va">fts_results</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.parameter</span>, <span class="va">.basis</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    mean_coef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.estimate</span><span class="op">)</span>,</span>
<span>    sd_coef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">.estimate</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   .parameter .basis                   mean_coef sd_coef</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> location   location_fts_index1_mean -<span style="color: #BB0000;">2.02</span><span style="color: #949494;">e</span><span style="color: #BB0000;">-12</span>   44.9 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> scale      scale_fts_index1_mean     5.22<span style="color: #949494;">e</span><span style="color: #BB0000;">-15</span>    1.17</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="forecasting-distributional-models">Forecasting distributional models<a class="anchor" aria-label="anchor" href="#forecasting-distributional-models"></a>
</h2>
<div class="section level3">
<h3 id="single-forecast-demonstration">Single forecast demonstration<a class="anchor" aria-label="anchor" href="#single-forecast-demonstration"></a>
</h3>
<p>Generate forecasts that provide both mean predictions and uncertainty
intervals based on the evolving variance structure:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fc_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span></span>
<span>  <span class="va">mcycle_gaulss_model</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">mcycle_test</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"ENS"</span>,</span>
<span>  mean_model <span class="op">=</span> <span class="st">"ENS"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Examine forecast structure</span></span>
<span><span class="va">fc_single</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 24 × 6</span></span></span>
<span><span class="co">#&gt;    .estimate .error  .q2.5  .q10  .q90 .q97.5</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     16.2    26.0  -<span style="color: #BB0000;">52.8</span> -<span style="color: #BB0000;">28.1</span>  69.5   94.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     26.4    28.3  -<span style="color: #BB0000;">59.2</span> -<span style="color: #BB0000;">29.9</span>  78.8  120. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     17.8    36.2 -<span style="color: #BB0000;">110.</span>  -<span style="color: #BB0000;">45.4</span>  86.8  132. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     35.7    29.7  -<span style="color: #BB0000;">59.5</span> -<span style="color: #BB0000;">15.3</span> 103.   126. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     17.6    30.9  -<span style="color: #BB0000;">52.0</span> -<span style="color: #BB0000;">28.2</span>  78.7  113. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>      7.02   33.6  -<span style="color: #BB0000;">63.9</span> -<span style="color: #BB0000;">43.0</span>  72.3  125. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     15.3    34.9 -<span style="color: #BB0000;">112.</span>  -<span style="color: #BB0000;">50.1</span>  94.5  119. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>      5.44   30.4  -<span style="color: #BB0000;">96.6</span> -<span style="color: #BB0000;">52.9</span>  71.3  102. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     17.5    24.4  -<span style="color: #BB0000;">61.0</span> -<span style="color: #BB0000;">31.5</span>  64.2   94.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     21.4    28.6 -<span style="color: #BB0000;">104.</span>  -<span style="color: #BB0000;">42.8</span>  64.4  115. </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 14 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-distributional-forecasts">Visualizing distributional forecasts<a class="anchor" aria-label="anchor" href="#visualizing-distributional-forecasts"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine training and forecast data for visualization</span></span>
<span><span class="va">forecast_plot_data</span> <span class="op">&lt;-</span> <span class="va">mcycle_train</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"observed"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="va">mcycle_test</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">fc_single</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">forecast_plot_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="va">accel</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">forecast_plot_data</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"observed"</span><span class="op">)</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.7</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">forecast_plot_data</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"forecast"</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.q2.5</span>, ymax <span class="op">=</span> <span class="va">.q97.5</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="st">"darkred"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">forecast_plot_data</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"forecast"</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.q10</span>, ymax <span class="op">=</span> <span class="va">.q90</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="st">"darkred"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">forecast_plot_data</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"forecast"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.estimate</span><span class="op">)</span>,</span>
<span>            colour <span class="op">=</span> <span class="st">"darkred"</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">forecast_plot_data</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"forecast"</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Distributional GAM forecasts for motorcycle crash acceleration"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Time Index"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Head Acceleration"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="distributional-regression_files/figure-html/forecast-visualization-1.png" class="r-plt" alt="Distributional forecasts capture both mean trends and evolving uncertainty from the time-varying scale parameter." width="672"><p class="caption">
Distributional forecasts capture both mean trends and evolving
uncertainty from the time-varying scale parameter.
</p>
</div>
<p>The widening prediction intervals in the test period reflect
increasing uncertainty as we forecast further from the training data, a
natural consequence of parameter extrapolation.</p>
</div>
</div>
<div class="section level2">
<h2 id="coefficient-forecast-inspection">Coefficient forecast inspection<a class="anchor" aria-label="anchor" href="#coefficient-forecast-inspection"></a>
</h2>
<p>We can also forecast the functional coefficients themselves to
understand how the underlying parameters evolve:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Forecast the coefficients to the test period</span></span>
<span><span class="va">coef_forecast_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span></span>
<span>  <span class="va">fts_results</span>,</span>
<span>  h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mcycle_test</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"ENS"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summarize coefficient forecasts</span></span>
<span><span class="va">coef_forecast</span> <span class="op">&lt;-</span> <span class="va">coef_forecast_raw</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.basis</span>, <span class="va">.time</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    .estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.sim</span><span class="op">)</span>,</span>
<span>    .q2.5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">.sim</span>, <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>    .q97.5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">.sim</span>, <span class="fl">0.975</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Summarize training coefficients</span></span>
<span><span class="va">fts_coefs_summary</span> <span class="op">&lt;-</span> <span class="va">fts_results</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.basis</span>, <span class="va">.time</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    .estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.estimate</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize coefficient evolution and forecasts</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fts_coefs_summary</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.time</span>, y <span class="op">=</span> <span class="va">.estimate</span>, color <span class="op">=</span> <span class="va">.basis</span><span class="op">)</span>,</span>
<span>            linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">coef_forecast</span>,</span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.time</span>, ymin <span class="op">=</span> <span class="va">.q2.5</span>, ymax <span class="op">=</span> <span class="va">.q97.5</span>, fill <span class="op">=</span> <span class="va">.basis</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">coef_forecast</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.time</span>, y <span class="op">=</span> <span class="va">.estimate</span>, color <span class="op">=</span> <span class="va">.basis</span><span class="op">)</span>,</span>
<span>            linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.basis</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Functional coefficients: training vs forecasted"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Time Index"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Coefficient Value"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="distributional-regression_files/figure-html/coefficient-forecasting-1.png" class="r-plt" alt="Forecasted functional coefficients show parameter-specific evolution patterns with quantified uncertainty." width="672"><p class="caption">
Forecasted functional coefficients show parameter-specific evolution
patterns with quantified uncertainty.
</p>
</div>
<p>The forecasts for both parameters reflect the underlying nonlinear
dynamics captured by the exponential smoothing and random walk ensemble
model.</p>
</div>
<div class="section level2">
<h2 id="rolling-forecast-evaluation">Rolling forecast evaluation<a class="anchor" aria-label="anchor" href="#rolling-forecast-evaluation"></a>
</h2>
<div class="section level3">
<h3 id="understanding-rolling-forecast-evaluation">Understanding rolling forecast evaluation<a class="anchor" aria-label="anchor" href="#understanding-rolling-forecast-evaluation"></a>
</h3>
<p><a href="https://otexts.com/fpp3/tscv.html" class="external-link">Rolling forecast
evaluation</a>, also known as time series cross-validation, provides a
more robust assessment of model performance than traditional train-test
splits. Instead of evaluating predictions from a single time point, this
approach tests how well a model performs when making forecasts from many
different origins throughout the time series. This mimics real-world
forecasting scenarios where we continuously update our models with new
data and generate fresh predictions.</p>
<p>The method works by sliding a fixed-size training window through the
time series. At each position, we fit the model using only the data
within that window, then generate forecasts for a specified number of
steps ahead (the forecast horizon). By advancing the window position
systematically (determined by the step size), we obtain multiple sets of
forecasts that can be evaluated against the actual observed values. This
reveals whether our model maintains consistent performance across
different time periods and data conditions.</p>
<p>For distributional models like ours, rolling evaluation is
particularly valuable because it tests whether prediction intervals
remain well-calibrated throughout the entire time series. In
safety-critical applications such as crash analysis, we need confidence
that our uncertainty estimates are reliable not just on average, but
consistently across all phases of the crash timeline.</p>
</div>
<div class="section level3">
<h3 id="rolling-forecast-parameters">Rolling forecast parameters<a class="anchor" aria-label="anchor" href="#rolling-forecast-parameters"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use 70 observations for each training window - enough data to estimate</span></span>
<span><span class="co"># time-varying parameters while allowing multiple forecast origins</span></span>
<span><span class="va">window_size</span> <span class="op">&lt;-</span> <span class="fl">70</span></span>
<span></span>
<span><span class="co"># Predict 5 steps ahead from each origin - tests short-term accuracy</span></span>
<span><span class="co"># relevant for crash dynamics without extending into highly uncertain territory  </span></span>
<span><span class="va">forecast_horizon</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># Advance forecast origin by 5 steps between evaluations - balances</span></span>
<span><span class="co"># computational cost with evaluation thoroughness</span></span>
<span><span class="va">step_size</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># Calculate where each forecast origin will be positioned</span></span>
<span><span class="va">max_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mcycle</span><span class="op">)</span> <span class="op">-</span> <span class="va">forecast_horizon</span></span>
<span><span class="va">forecast_starts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">max_start</span> <span class="op">-</span> <span class="va">window_size</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">step_size</span><span class="op">)</span></span></code></pre></div>
<p>The choice of window size reflects a trade-off between having enough
data to reliably estimate model parameters and maintaining enough
forecast origins for robust evaluation. Our window of 50 observations
captures sufficient crash dynamics while the step size of 10 provides
reasonable coverage of the timeline without excessive computational
burden. The 10-step forecast horizon tests the model’s ability to
predict the immediate future, which is most relevant for understanding
crash dynamics where conditions can change rapidly.</p>
</div>
<div class="section level3">
<h3 id="executing-rolling-forecasts">Executing rolling forecasts<a class="anchor" aria-label="anchor" href="#executing-rolling-forecasts"></a>
</h3>
<p>The rolling forecast loop systematically moves through the time
series, fitting a fresh model at each origin and generating predictions
for the subsequent time points. This process simulates how forecasting
works in practice, where we periodically retrain our models with the
latest available data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># List to accumulate results from each forecast origin</span></span>
<span><span class="va">rolling_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through each forecast origin position</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">forecast_starts</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Define the training window boundaries</span></span>
<span>  <span class="va">start_idx</span> <span class="op">&lt;-</span> <span class="va">forecast_starts</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">end_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">start_idx</span> <span class="op">+</span> <span class="va">window_size</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mcycle</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Extract training data for this window</span></span>
<span>  <span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">mcycle</span><span class="op">[</span><span class="va">start_idx</span><span class="op">:</span><span class="va">end_idx</span>, <span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Define the test period immediately following the training window</span></span>
<span>  <span class="va">test_start</span> <span class="op">&lt;-</span> <span class="va">end_idx</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">test_end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">test_start</span> <span class="op">+</span> <span class="va">forecast_horizon</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mcycle</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Only proceed if we have enough data for the full test period</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">test_end</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mcycle</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">mcycle</span><span class="op">[</span><span class="va">test_start</span><span class="op">:</span><span class="va">test_end</span>, <span class="op">]</span></span>
<span></span>
<span>    <span class="co"># Fit a distributional model to the training window</span></span>
<span>    <span class="co"># Using mean_only = TRUE for computational efficiency in the loop</span></span>
<span>    <span class="va">roll_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ffc_gam.html">ffc_gam</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="va">accel</span> <span class="op">~</span> <span class="fu"><a href="../reference/fts.html">fts</a></span><span class="op">(</span><span class="va">index</span>, mean_only <span class="op">=</span> <span class="cn">TRUE</span>, time_k <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>        <span class="op">~</span> <span class="fu"><a href="../reference/fts.html">fts</a></span><span class="op">(</span><span class="va">index</span>, mean_only <span class="op">=</span> <span class="cn">TRUE</span>, time_k <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gaulss.html" class="external-link">gaulss</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      data <span class="op">=</span> <span class="va">train_data</span>,</span>
<span>      time <span class="op">=</span> <span class="st">"index"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Generate forecasts for the test period using ensemble method</span></span>
<span>    <span class="va">roll_forecast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span></span>
<span>      <span class="va">roll_model</span>,</span>
<span>      newdata <span class="op">=</span> <span class="va">test_data</span>,</span>
<span>      model <span class="op">=</span> <span class="st">"ENS"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Combine actual values with predictions and add tracking metadata</span></span>
<span>    <span class="va">rolling_results</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">test_data</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">roll_forecast</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        forecast_origin <span class="op">=</span> <span class="va">i</span>,</span>
<span>        train_start <span class="op">=</span> <span class="va">start_idx</span>,</span>
<span>        train_end <span class="op">=</span> <span class="va">end_idx</span>,</span>
<span>        horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Combine all forecast results into a single data frame for analysis</span></span>
<span><span class="va">rolling_forecasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">rolling_results</span><span class="op">)</span></span></code></pre></div>
<p>Each iteration of this loop represents a realistic forecasting
scenario where we have historical data up to a certain point (the
training window) and must predict what happens next. The metadata we
track allows us to analyze how performance varies by forecast origin and
horizon.</p>
</div>
</div>
<div class="section level2">
<h2 id="rolling-forecast-performance-analysis">Rolling forecast performance analysis<a class="anchor" aria-label="anchor" href="#rolling-forecast-performance-analysis"></a>
</h2>
<div class="section level3">
<h3 id="forecast-accuracy-metrics">Forecast accuracy metrics<a class="anchor" aria-label="anchor" href="#forecast-accuracy-metrics"></a>
</h3>
<p>To evaluate our distributional forecasts comprehensively, we
calculate both point forecast accuracy measures and <a href="https://otexts.com/fpp3/distaccuracy.html" class="external-link">coverage statistics</a>
for the prediction intervals. Coverage refers to the proportion of
actual observations that fall within the predicted intervals. A
well-calibrated 95% prediction interval should contain the true value
approximately 95% of the time across many forecasts. If coverage is
substantially lower, the model is overconfident; if higher, it is being
unnecessarily conservative.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate comprehensive performance metrics for each forecast</span></span>
<span><span class="va">rolling_forecasts</span> <span class="op">&lt;-</span> <span class="va">rolling_forecasts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Point forecast errors</span></span>
<span>    forecast_error <span class="op">=</span> <span class="va">accel</span> <span class="op">-</span> <span class="va">.estimate</span>,</span>
<span>    abs_error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">forecast_error</span><span class="op">)</span>,</span>
<span>    squared_error <span class="op">=</span> <span class="va">forecast_error</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>    </span>
<span>    <span class="co"># Coverage indicators: TRUE if actual value falls within interval</span></span>
<span>    coverage_95 <span class="op">=</span> <span class="op">(</span><span class="va">accel</span> <span class="op">&gt;=</span> <span class="va">.q2.5</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">accel</span> <span class="op">&lt;=</span> <span class="va">.q97.5</span><span class="op">)</span>,</span>
<span>    coverage_80 <span class="op">=</span> <span class="op">(</span><span class="va">accel</span> <span class="op">&gt;=</span> <span class="va">.q10</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">accel</span> <span class="op">&lt;=</span> <span class="va">.q90</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># Interval widths to assess uncertainty magnitude</span></span>
<span>    interval_width_95 <span class="op">=</span> <span class="va">.q97.5</span> <span class="op">-</span> <span class="va">.q2.5</span>,</span>
<span>    interval_width_80 <span class="op">=</span> <span class="va">.q90</span> <span class="op">-</span> <span class="va">.q10</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Performance by forecast horizon</span></span>
<span><span class="va">horizon_stats</span> <span class="op">&lt;-</span> <span class="va">rolling_forecasts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">horizon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    n_forecasts <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    mae <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">abs_error</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    rmse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">squared_error</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    coverage_95 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">coverage_95</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    coverage_80 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">coverage_80</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    avg_width_95 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">interval_width_95</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    avg_width_80 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">interval_width_80</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">'drop'</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">horizon_stats</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 8</span></span></span>
<span><span class="co">#&gt;   horizon n_forecasts   mae  rmse coverage_95 coverage_80 avg_width_95</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>       1          12  27.0  35.3       0.833       0.667         114.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>       2          12  31.6  41.5       0.75        0.667         112.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>       3          12  26.0  32.4       0.833       0.833         114.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>       4          12  27.4  31.1       1           0.75          122.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>       5          12  23.0  29.6       0.917       0.833         122.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: avg_width_80 &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="co"># Overall performance summary  </span></span>
<span><span class="va">overall_stats</span> <span class="op">&lt;-</span> <span class="va">rolling_forecasts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    total_forecasts <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    overall_mae <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">abs_error</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    overall_rmse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">squared_error</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    overall_coverage_95 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">coverage_95</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    overall_coverage_80 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">coverage_80</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- 95% coverage:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">overall_stats</span><span class="op">$</span><span class="va">overall_coverage_95</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - 95% coverage: 86.7 %</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- 80% coverage:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">overall_stats</span><span class="op">$</span><span class="va">overall_coverage_80</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - 80% coverage: 75 %</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="rolling-forecast-visualization">Rolling forecast visualization<a class="anchor" aria-label="anchor" href="#rolling-forecast-visualization"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize rolling forecasts over the full time series</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mcycle</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="va">accel</span><span class="op">)</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.4</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mcycle</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="va">accel</span><span class="op">)</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rolling_forecasts</span>,</span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="va">.estimate</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"darkred"</span>, size <span class="op">=</span> <span class="fl">1.5</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rolling_forecasts</span>,</span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, ymin <span class="op">=</span> <span class="va">.q10</span>, ymax <span class="op">=</span> <span class="va">.q90</span><span class="op">)</span>,</span>
<span>                color <span class="op">=</span> <span class="st">"darkred"</span>, alpha <span class="op">=</span> <span class="fl">0.6</span>, width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rolling_forecasts</span>,</span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, xend <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="va">accel</span>, yend <span class="op">=</span> <span class="va">.estimate</span><span class="op">)</span>,</span>
<span>               color <span class="op">=</span> <span class="st">"darkblue"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Rolling forecast evaluation across crash timeline"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Time Index"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Head Acceleration"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="distributional-regression_files/figure-html/rolling-visualization-1.png" class="r-plt" alt="Rolling forecast evaluation reveals consistent prediction performance across different crash phases." width="672"><p class="caption">
Rolling forecast evaluation reveals consistent prediction performance
across different crash phases.
</p>
</div>
<p>The plot shows forecasts (red points) with 80% prediction intervals
capturing the observed values across diverse crash phases, demonstrating
consistent model performance.</p>
</div>
<div class="section level3">
<h3 id="coverage-evolution-analysis">Coverage evolution analysis<a class="anchor" aria-label="anchor" href="#coverage-evolution-analysis"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Track coverage evolution over evaluation period</span></span>
<span><span class="va">coverage_data</span> <span class="op">&lt;-</span> <span class="va">rolling_forecasts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    running_coverage_95 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">coverage_95</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    running_coverage_80 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">coverage_80</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">coverage_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">running_coverage_95</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkred"</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">running_coverage_80</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkblue"</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.95</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"darkred"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.80</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"darkblue"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Cumulative coverage rates validate interval calibration"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Time Index"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Cumulative Coverage Rate"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="distributional-regression_files/figure-html/coverage-evolution-1.png" class="r-plt" alt="Cumulative coverage rates demonstrate improved coverage of prediction intervals throughout the evaluation." width="672"><p class="caption">
Cumulative coverage rates demonstrate improved coverage of prediction
intervals throughout the evaluation.
</p>
</div>
<p>The cumulative coverage rates fluctuate across the time index,
revealing how the forecasts did not anticipate the initial, major rise
in both acceleration and the variance. Once the models had seen that
period, the forecasts improved substantially.</p>
</div>
</div>
<div class="section level2">
<h2 id="key-insights-and-best-practices">Key insights and best practices<a class="anchor" aria-label="anchor" href="#key-insights-and-best-practices"></a>
</h2>
<div class="section level3">
<h3 id="when-to-use-distributional-regression">When to use distributional regression<a class="anchor" aria-label="anchor" href="#when-to-use-distributional-regression"></a>
</h3>
<p>Distributional regression with <code>ffc</code> is essential
when:</p>
<ul>
<li>Data exhibits clear heteroskedasticity (changing variance over
time)<br>
</li>
<li>Both mean trends and uncertainty evolution matter for
interpretation<br>
</li>
<li>Risk assessment requires proper uncertainty bounds<br>
</li>
<li>Traditional constant-variance assumptions are violated</li>
</ul>
<p>Key implementation considerations:</p>
<ul>
<li>Use list formula syntax:
<code>list(response ~ fts(...), ~ fts(...))</code><br>
</li>
<li>Choose appropriate distributional families (<a href="https://rdrr.io/cran/mgcv/man/gaulss.html" class="external-link"><code>gaulss()</code></a>,
<a href="https://rdrr.io/cran/mgcv/man/twlss.html" class="external-link"><code>twlss()</code></a>,
<a href="https://rdrr.io/cran/mgcv/man/betar.html" class="external-link"><code>betar()</code></a>)<br>
</li>
<li>Scale parameter automatically uses log-link for positivity<br>
</li>
<li>Different <code>time_k</code> values can be used for different
parameters</li>
</ul>
</div>
<div class="section level3">
<h3 id="distributional-forecasting-advantages">Distributional forecasting advantages<a class="anchor" aria-label="anchor" href="#distributional-forecasting-advantages"></a>
</h3>
<p>The time-varying distributional approach excels when:</p>
<ul>
<li>Traditional homoskedastic models miss variance patterns<br>
</li>
<li>Parameter-specific uncertainty quantification is needed<br>
</li>
<li>Rolling validation reveals model robustness across conditions<br>
</li>
<li>Safety applications require conservative interval estimation</li>
</ul>
<p>For detailed guidance on distributional families in <a href="https://cran.r-project.org/package=mgcv" class="external-link"><code>mgcv</code></a>,
see <a href="https://www.routledge.com/Generalized-Additive-Models-An-Introduction-with-R-Second-Edition/Wood/p/book/9781498728331" class="external-link">Wood
(2017)</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette demonstrated advanced distributional regression
techniques for motorcycle crash data:</p>
<ul>
<li>Time-varying location and scale parameters capture evolving crash
dynamics<br>
</li>
<li>Functional time series coefficients provide interpretable parameter
evolution<br>
</li>
<li>Rolling forecast evaluation ensures robust model validation<br>
</li>
<li>Proper uncertainty quantification enables safety-critical
applications</li>
</ul>
<p>The <code>ffc</code> package integrates distributional modeling
seamlessly with functional forecasting: - List formula syntax for
multi-parameter specifications<br>
- Parameter-specific coefficient extraction and forecasting<br>
- Comprehensive validation through rolling forecast techniques<br>
- Integration with <a href="https://cran.r-project.org/package=mgcv" class="external-link"><code>mgcv</code></a>
distributional families</p>
<div class="section level3">
<h3 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h3>
<ul>
<li>Wood (2017): <a href="https://www.routledge.com/Generalized-Additive-Models-An-Introduction-with-R-Second-Edition/Wood/p/book/9781498728331" class="external-link">Generalized
Additive Models: An Introduction with R</a><br>
</li>
<li>Rigby &amp; Stasinopoulos (2005): <a href="https://doi.org/10.1111/j.1467-9876.2005.00510.x" class="external-link">Generalized
additive models for location, scale and shape</a><br>
</li>
<li>Hyndman &amp; Athanasopoulos (2021): <a href="https://otexts.com/fpp3/" class="external-link">Forecasting: Principles and
Practice</a><br>
</li>
<li><a href="https://rdrr.io/cran/mgcv/man/family.mgcv.html" class="external-link">mgcv
distributional families documentation</a></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ecogambler.netlify.app/" class="external-link">Nicholas J Clark</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
