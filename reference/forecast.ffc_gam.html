<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Forecasting ffc_gam models — forecast.ffc_gam • ffc</title><!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Forecasting ffc_gam models — forecast.ffc_gam"><meta name="description" content="Forecasting ffc_gam models"><meta property="og:description" content="Forecasting ffc_gam models"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ffc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/mortality-analysis.html">Modeling Mortality Trends with Functional Forecasting</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nicholasjclark/ffc" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Forecasting <code>ffc_gam</code> models</h1>
      <small class="dont-index">Source: <a href="https://github.com/nicholasjclark/ffc/blob/main/R/forecast.R" class="external-link"><code>R/forecast.R</code></a></small>
      <div class="d-none name"><code>forecast.ffc_gam.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Forecasting <code>ffc_gam</code> models</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'ffc_gam'</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">newdata</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"response"</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"ETS"</span>,</span>
<span>  stationary <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  summary <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  robust <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.975</span><span class="op">)</span>,</span>
<span>  mean_model <span class="op">=</span> <span class="st">"ETS"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>An object of class <code>ffc_gam</code>. See <code><a href="ffc_gam.html">ffc_gam()</a></code></p></dd>


<dt id="arg-newdata">newdata<a class="anchor" aria-label="anchor" href="#arg-newdata"></a></dt>
<dd><p><code>dataframe</code> or <code>list</code> of test data containing the
same variables that were included in the original <code>data</code> used to fit the
model. The covariate information in <code>newdata</code>, along with the temporal information
indexed by the <code>time</code> variable in the original call to <code><a href="ffc_gam.html">ffc_gam()</a></code>, will be used to
generate forecasts from the fitted model equations</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>When this has the value <code>link</code>, the linear predictor is calculated
on the link scale. If <code>expected</code> is used, predictions reflect the expectation
of the response (the mean) but ignore uncertainty in the observation process.
When <code>response</code> is used (the default), the predictions take uncertainty in the observation
process into account to return predictions on the outcome scale</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A <code>character</code> string representing a valid univariate model definition
from the <span class="pkg">fable</span> package or one of the built-in Bayesian dynamic
factor models. Note that if a <span class="pkg">fable</span> model is used,
the chosen method must have an associated
<code><a href="https://generics.r-lib.org/reference/generate.html" class="external-link">generate()</a></code> method in order to simulate forecast realisations. Valid models
currently include: <code>'ARDF'</code>, <code>'GPDF'</code>, '<code>VARDF</code>,
<code>'ETS'</code>, <code>'ARIMA'</code>, <code>'AR'</code>, <code>'RW'</code>, <code>'NAIVE'</code>, and <code>'NNETAR'</code></p></dd>


<dt id="arg-stationary">stationary<a class="anchor" aria-label="anchor" href="#arg-stationary"></a></dt>
<dd><p>If <code>TRUE</code>, the fitted time series models are
constrained to be stationary. Default is <code>FALSE</code>. This option
only works when <code>model == 'ARIMA'</code></p></dd>


<dt id="arg-summary">summary<a class="anchor" aria-label="anchor" href="#arg-summary"></a></dt>
<dd><p>Should summary statistics be returned instead of the raw values?
Default is <code>TRUE</code></p></dd>


<dt id="arg-robust">robust<a class="anchor" aria-label="anchor" href="#arg-robust"></a></dt>
<dd><p>If <code>FALSE</code> (the default) the mean is used as the measure of
central tendency and the standard deviation as the measure of variability.
If <code>TRUE</code>, the median and the median absolute deviation (MAD) are applied instead.
Only used if <code>summary</code> is <code>TRUE</code></p></dd>


<dt id="arg-probs">probs<a class="anchor" aria-label="anchor" href="#arg-probs"></a></dt>
<dd><p>The percentiles to be computed by the <code><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile()</a></code> function.
Only used if <code>summary</code> is <code>TRUE</code></p></dd>


<dt id="arg-mean-model">mean_model<a class="anchor" aria-label="anchor" href="#arg-mean-model"></a></dt>
<dd><p>A character string specifying the forecasting model to use
for mean basis coefficients when using Stan factor models (ARDF, VARDF, GPDF).
Default is "ETS". Options include "ETS", "ARIMA", "RW", "NAIVE".
This is only used when forecasting mixed mean/non-mean basis functions with
Stan factor models.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments for Stan dynamic factor models (ARDF, VARDF, GPDF):</p><dl><dt>K</dt>
<dd><p>Number of latent factors (default: 2). Must be positive.</p></dd>

<dt>lag</dt>
<dd><p>Number of time lags for autoregressive terms (default: 1). Must be positive.</p></dd>

<dt>chains</dt>
<dd><p>Number of MCMC chains (default: 4)</p></dd>

<dt>iter</dt>
<dd><p>Total iterations per chain (default: 500)</p></dd>

<dt>warmup</dt>
<dd><p>Warmup iterations per chain (default: iter/2)</p></dd>

<dt>cores</dt>
<dd><p>Number of CPU cores to use (default: min(chains, available cores))</p></dd>

<dt>adapt_delta</dt>
<dd><p>Target acceptance rate (default: 0.75)</p></dd>

<dt>max_treedepth</dt>
<dd><p>Maximum tree depth (default: 9)</p></dd>

<dt>times</dt>
<dd><p>Number of posterior samples to draw for coefficient forecasting.
For Stan models, this is automatically set to (iter - warmup) * chains
to ensure dimension consistency. Minimum 100 total posterior samples required.</p></dd>


</dl></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Predicted values on the appropriate scale.
If <code>summary == FALSE</code>, the output is a matrix. If <code>summary == TRUE</code>, the output
is a tidy <code>tbl_df / data.frame</code></p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Forecasting Methodology:</strong></p>
<p>This function implements a two-stage forecasting approach for functional regression
models with time-varying coefficients of the form:
$$y_t = \sum_{j=1}^{J} \beta_j(t) B_j(x) + \epsilon_t$$
where \(\beta_j(t)\) are time-varying coefficients and \(B_j(x)\) are basis functions.</p>
<ol><li><p><strong>Extract basis coefficients:</strong> Time-varying functional coefficients
\(\beta_j(t)\) are extracted from the fitted GAM as time series</p></li>
<li><p><strong>Forecast coefficients:</strong> These coefficient time series are forecast
using either Stan dynamic factor models (ARDF/VARDF/GPDF) or ARIMA models</p></li>
<li><p><strong>Reconstruct forecasts:</strong> Forecasted coefficients are combined:
$$\hat{y}_{t+h} = \sum_{j=1}^{J} \hat{\beta}_j(t+h) B_j(x)$$</p></li>
<li><p><strong>Combine uncertainties:</strong> Multiple uncertainty sources are integrated
hierarchically (see Uncertainty Quantification section)</p></li>
</ol><p><strong>Uncertainty Quantification:</strong></p>
<p>Forecast uncertainty is captured through a hierarchical structure:</p>
<p><em>Within Stan dynamic factor models:</em></p><ul><li><p><strong>Process uncertainty:</strong> Factor dynamics, autoregressive terms, factor loadings</p></li>
<li><p><strong>Observation uncertainty:</strong> Series-specific error terms (\(\sigma_{obs}\))</p></li>
</ul><p><em>Final combination in linear predictor space:</em></p><ul><li><p><strong>Stan forecast samples:</strong> Already incorporate process + observation uncertainty</p></li>
<li><p><strong>GAM parameter uncertainty:</strong> Random draws from \(N(\hat{\boldsymbol{\theta}}, \mathbf{V})\)
where \(\mathbf{V}\) is the coefficient covariance matrix</p></li>
</ul><p>These components are combined additively: \(\text{Stan forecasts} + \text{GAM uncertainty}\)</p>
<p><strong>Model Selection:</strong></p>
<ul><li><p><strong>Stan factor models (ARDF/VARDF/GPDF):</strong> Used for multivariate
forecasting of non-mean basis coefficients. Capture dependencies between
coefficient series and assume zero-centered time series for efficiency.</p></li>
<li><p><strong>Mean basis models:</strong> Used for mean basis coefficients (which operate
at non-zero levels). Default is ETS, controlled by <code>mean_model</code> parameter.</p></li>
</ul><p><strong>Important Note on <code>times</code> Parameter:</strong></p>
<p>For Stan dynamic factor models, the <code>times</code> parameter is automatically set to
<code>(iter - warmup) * chains</code> to ensure dimensional consistency. Any user-specified
<code>times</code> value will be ignored with a warning. For ARIMA models, <code>times</code> can be
specified freely and controls the number of posterior draws.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="ffc_gam.html">ffc_gam()</a></code>, <code><a href="fts.html">fts()</a></code>, <code><a href="forecast.fts_ts.html">forecast.fts_ts()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Nicholas J Clark</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Basic forecasting example</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"growth_data"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="ffc_gam.html">ffc_gam</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">Reaction</span> <span class="op">~</span> <span class="fu"><a href="fts.html">fts</a></span><span class="op">(</span><span class="va">Subject</span>, k <span class="op">=</span> <span class="fl">3</span>, time_k <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>             <span class="fu"><a href="fts.html">fts</a></span><span class="op">(</span><span class="va">Days</span>, k <span class="op">=</span> <span class="fl">3</span>, time_k <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  time <span class="op">=</span> <span class="st">"Days"</span>, data <span class="op">=</span> <span class="va">growth_data</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> the variable 'Days' cannot be found in data</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Forecast with ETS (default for mixed basis)</span></span></span>
<span class="r-in"><span><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Subject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"308"</span>, <span class="fl">3</span><span class="op">)</span>, Days <span class="op">=</span> <span class="fl">10</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">newdata</span>, model <span class="op">=</span> <span class="st">"ETS"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'mod' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use ARDF with custom mean_model for mean basis</span></span></span>
<span class="r-in"><span><span class="va">fc_ardf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">newdata</span>,</span></span>
<span class="r-in"><span>                    model <span class="op">=</span> <span class="st">"ARDF"</span>,</span></span>
<span class="r-in"><span>                    mean_model <span class="op">=</span> <span class="st">"RW"</span>,  <span class="co"># Use random walk for mean basis</span></span></span>
<span class="r-in"><span>                    K <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'mod' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get raw forecast matrix without summary</span></span></span>
<span class="r-in"><span><span class="va">fc_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">newdata</span>,</span></span>
<span class="r-in"><span>                  model <span class="op">=</span> <span class="st">"ETS"</span>,</span></span>
<span class="r-in"><span>                  summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'mod' not found</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ecogambler.netlify.app/" class="external-link">Nicholas J Clark</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

