<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Define functions with dynamic coefficients in ffc formulae — fts • ffc</title><!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Define functions with dynamic coefficients in ffc formulae — fts"><meta name="description" content="Set up smooth terms with time-varying (dynamic) coefficients for use in
ffc models"><meta property="og:description" content="Set up smooth terms with time-varying (dynamic) coefficients for use in
ffc models"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ffc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/mortality-analysis.html">Modeling Mortality Trends with Functional Forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/elnino-forecasting.html">Forecasting El Niño Patterns with Cyclic Splines and Dynamic Factor Models</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nicholasjclark/ffc" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Define functions with dynamic coefficients in <span class="pkg">ffc</span> formulae</h1>
      <small class="dont-index">Source: <a href="https://github.com/nicholasjclark/ffc/blob/main/R/fts.R" class="external-link"><code>R/fts.R</code></a></small>
      <div class="d-none name"><code>fts.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Set up smooth terms with time-varying (dynamic) coefficients for use in
<span class="pkg">ffc</span> models</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fts</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  mean_only <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  k <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  time_k <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  bs <span class="op">=</span> <span class="st">"cr"</span>,</span>
<span>  time_bs <span class="op">=</span> <span class="st">"ts"</span>,</span>
<span>  m <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  time_m <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  share_penalty <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  d <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  by <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  xt <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pc <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>a list of variables that are the covariates that this smooth is a function of.
Transformations whose form depends on the values of the data are best avoided here:
e.g. <code>fts(log(x), z)</code> is fine, but <code>fts(I(x / sd(x)), z)</code> is not.</p></dd>


<dt id="arg-mean-only">mean_only<a class="anchor" aria-label="anchor" href="#arg-mean-only"></a></dt>
<dd><p><code>Logical</code> indicating whether to only include a single basis function
to be modelled as time-varying. This can be helpful if you wish to include a temporal
trend that can then be forecasted ahead using appropriate time series models.
Default is <code>FALSE</code></p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>the dimension(s) of the bases used to represent the smooth term.
If not supplied then set either to <code>10</code> (if only a single covariate is supplied) or
to <code>5 ^ d</code>, where <code>d</code> is the number of covariates supplied.
If supplied as a single number then this basis dimension is used for each basis.
If supplied as an array then the elements are the dimensions of the component (marginal)
bases of the tensor product.</p></dd>


<dt id="arg-time-k">time_k<a class="anchor" aria-label="anchor" href="#arg-time-k"></a></dt>
<dd><p>the dimension of the bases to be used in the time-varying coefficient
smooths (see <strong>Details</strong> below). Arbitrarily set to <code>10</code> by default.</p></dd>


<dt id="arg-bs">bs<a class="anchor" aria-label="anchor" href="#arg-bs"></a></dt>
<dd><p>array (or single character string) specifying the type for each
marginal basis. <code>"cr"</code> for cubic regression spline; <code>"cs"</code> for cubic
regression spline with shrinkage; <code>"cc"</code> for periodic/cyclic
cubic regression spline; <code>"tp"</code> for thin plate regression spline;
<code>"ts"</code> for t.p.r.s. with extra shrinkage. See <code><a href="https://rdrr.io/pkg/mgcv/man/smooth.terms.html" class="external-link">smooth.terms</a></code> for details
and full list. User defined bases can
also be used here (see <code><a href="https://rdrr.io/pkg/mgcv/man/smooth.construct.html" class="external-link">smooth.construct</a></code> for an example). If only one
basis code is given then this is used for all bases.</p></dd>


<dt id="arg-time-bs">time_bs<a class="anchor" aria-label="anchor" href="#arg-time-bs"></a></dt>
<dd><p>a two letter <code>character</code> string indicating the (penalized)
smoothing basis to use for the time-varying basis coefficients (eg <code>"tp"</code> for thin
plate regression spline, <code>"cr"</code> for cubic regression spline).
see <code><a href="https://rdrr.io/pkg/mgcv/man/smooth.terms.html" class="external-link">smooth.terms</a></code> for an over view of what is available. It is
generally recommended that you stick with one of the doubly-penalized bases
(i.e. <code>"cs"</code> or <code>"ts"</code>)
as this helps to ensure the resulting basis function coefficient time series are
estimated on an appropriate scale for later forecasting</p></dd>


<dt id="arg-m">m<a class="anchor" aria-label="anchor" href="#arg-m"></a></dt>
<dd><p>The order of the spline and its penalty (for smooth classes that use this) for each term.
   If a single number is given  then it is used for all terms. A vector can be used to
  supply a different <code>m</code> for each margin. For marginals that take vector <code>m</code>
  (e.g. <code><a href="https://rdrr.io/pkg/mgcv/man/smooth.construct.ps.smooth.spec.html" class="external-link">p.spline</a></code> and <code><a href="https://rdrr.io/pkg/mgcv/man/smooth.construct.ds.smooth.spec.html" class="external-link">Duchon.spline</a></code>), then
  a list can be supplied, with a vector element for each margin. <code>NA</code> autoinitializes.
  <code>m</code> is ignored by some bases (e.g. <code>"cr"</code>).</p></dd>


<dt id="arg-time-m">time_m<a class="anchor" aria-label="anchor" href="#arg-time-m"></a></dt>
<dd><p>the order of the penalty for the time-varying coefficient smooths
(e.g. <code>2</code> for normal cubic spline penalty with 2nd derivatives).
Only some smooth classes use this. The <code>"ps"</code> class can use a <code>2</code> item <code>array</code>
giving the basis and penalty order separately.</p></dd>


<dt id="arg-share-penalty">share_penalty<a class="anchor" aria-label="anchor" href="#arg-share-penalty"></a></dt>
<dd><p><code>logical</code> specifying whether the time-varying coefficient smooths for
this term should all share a smoothing penalty. Defaults to <code>TRUE</code> for single-parameter
families, but automatically set to <code>FALSE</code> for distributional families (list formulae)
to prevent mgcv fitting issues. Changing to <code>FALSE</code> gives more flexibility to capture
time-varying functions.</p></dd>


<dt id="arg-d">d<a class="anchor" aria-label="anchor" href="#arg-d"></a></dt>
<dd><p>array of marginal basis dimensions. For example if you want a smooth for 3 covariates
made up of a tensor product of a 2 dimensional t.p.r.s. basis and a 1-dimensional basis, then
set <code>d=c(2,1)</code>. Incompatibilities between built in basis types and dimension will be
resolved by resetting the basis type.</p></dd>


<dt id="arg-by">by<a class="anchor" aria-label="anchor" href="#arg-by"></a></dt>
<dd><p>a <code>factor</code> variable of the same dimension as each covariate, used to create
a replicate of the smooth for each factor level.</p></dd>


<dt id="arg-xt">xt<a class="anchor" aria-label="anchor" href="#arg-xt"></a></dt>
<dd><p>Either a single object, providing any extra information to be passed
to each marginal basis constructor, or a list of such objects, one for each
marginal basis.</p></dd>


<dt id="arg-pc">pc<a class="anchor" aria-label="anchor" href="#arg-pc"></a></dt>
<dd><p>If not <code>NULL</code>, signals a point constraint: the smooth should pass through zero at the
point given here (as a vector or list with names corresponding to the smooth names). Never ignored
if supplied. See <code><a href="https://rdrr.io/pkg/mgcv/man/identifiability.html" class="external-link">identifiability</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A class <code>fts.spec</code> object defining the smooth function
to be evaluated and configured for estimating time-varying basis function coefficients</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><span class="pkg">ffc</span> will evaluate the basis from these smooths and add the basis functions
to the internal model design matrix. Once these basis function predictors are added to the data,
a model will then be estimated that allows their coefficients to change through time using
terms such as
<code>s(time, by = bfun_1, id = 1, bs = 'cr') + s(time, by = bfun_2, id = 1, bs = 'cr') + ...</code>.
By linking the smoothing parameters using the <code>id</code> argument, the time-varying function will
be efficiently regularised.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Nicholas J Clark</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Define a time-varying smooth function of age</span></span></span>
<span class="r-in"><span><span class="fu">fts</span><span class="op">(</span><span class="va">age</span>, k <span class="op">=</span> <span class="fl">8</span>, bs <span class="op">=</span> <span class="st">"cr"</span>, time_k <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $call</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "s(age, k = 8, bs = \"cr\")"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $term</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "age"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $by</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "NA"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $time_bs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "ts"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $time_k</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $time_m</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "fts_age"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $mean_only</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $share_penalty</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ecogambler.netlify.app/" class="external-link">Nicholas J Clark</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

