% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ffc_gam.R
\name{ffc_gam}
\alias{ffc_gam}
\title{Fit a functional time series model using dynamic functional coefficients}
\usage{
ffc_gam(
  formula,
  family = gaussian(),
  data = list(),
  time,
  engine = c("gam", "bam"),
  ...
)
}
\arguments{
\item{formula}{A GAM formula (see \code{\link[mgcv]{formula.gam}} and also
\code{\link[mgcv]{gam.models}}). This is exactly like the formula for a
GLM except that smooth terms, \code{\link[=fts]{fts()}}, \code{\link[mgcv]{s}()} and
\code{\link[mgcv]{te}()} can be added to the right hand side to specify
that the linear predictor depends on smooth functions of predictors
(or linear functionals of these).}

\item{family}{
This is a family object specifying the distribution and link to use in
fitting etc. See \code{\link{glm}} and \code{\link{family}} for more
details. The extended families listed in \code{\link[mgcv]{family.mgcv}} can also be used.
}

\item{data}{A \code{data.frame} containing the variables in the model. Unlike
\code{\link[mgcv]{gam}}, \code{ffc_gam} requires data to be a data.frame and does
not support list data structures.}

\item{time}{\code{character} specifying which variable in \code{data} represents the
the time ordering of the observations}

\item{engine}{\code{character} string specifying which \pkg{mgcv} interface to use
for fitting the model.}

\item{...}{other arguments to pass to either \code{\link[mgcv]{gam}}}
}
\value{
An object of class \code{ffc_gam}, which inherits from objects of class \code{gam} or
\code{bam}. Use \code{methods(class = "ffc_gam")} to see available methods.
}
\description{
Fit Generalized Additive Models that can include time-varying (dynamic)
functions
}
\details{
This function will update the supplied \code{formula} to ensure any time-varying
functionals (supplied through \code{\link[=fts]{fts()}} terms in the formula right hand side) are
appropriately incorporated into the model. It then passes the updated model and data
objects to the specified \code{engine} for model fitting
}
\examples{
# Fit a dynamic function-on-function regression to the Queensland
# mortality data
data("qld_mortality")
mod <- ffc_gam(
  deaths ~
    offset(log(population)) +
    sex +
    fts(age,
      k = 8,
      time_k = 10
    ),
  time = "year",
  data = qld_mortality,
  family = poisson(),
  engine = "bam"
)
class(mod)
summary(mod)

# Distributional regression with gaulss() family
# Simulated data with time-varying location and scale
library(mgcv)
set.seed(1234)
n <- 50
sim_data <- data.frame(
  time = 1:n,
  x = rnorm(n),
  y = rnorm(n, mean = sin(2 * pi * (1:n) / 20),
            sd = 0.5 + 0.3 * cos(2 * pi * (1:n) / 15))
)

# Fit distributional model with time-varying parameters
dist_mod <- ffc_gam(
  list(
    y ~ fts(x, k = 5),      # Location parameter
    ~ fts(x, k = 3)         # Scale parameter
  ),
  family = gaulss(),
  data = sim_data,
  time = "time"
)

# Extract parameter-specific coefficients
coefs <- fts_coefs(dist_mod)
print(unique(coefs$.parameter))  # Shows "location" and "scale"

# Extract and visualize time-varying coefficients
coefs <- fts_coefs(mod, summary = FALSE, n_samples = 5)
autoplot(coefs)

# Forecast future mortality patterns
future_data <- expand.grid(
  age = unique(qld_mortality$age),
  sex = unique(qld_mortality$sex),
  year = 2021:2025,
  # Use rate scale (to predict deaths per person)
  population = 1
)

# Generate forecasts using ETS model for coefficients
mortality_fc <- forecast(mod, newdata = future_data, model = "ETS",
                         type = "expected")
head(mortality_fc)

}
\seealso{
\code{\link[=fts]{fts()}}, \code{\link[=forecast.ffc_gam]{forecast.ffc_gam()}}, \code{\link[=fts_coefs]{fts_coefs()}}, \code{\link[mgcv]{gam}}, \code{\link[mgcv]{bam}}
}
\author{
Nicholas J Clark
}
