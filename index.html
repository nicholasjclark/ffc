<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>ffc â€¢ Functional ForeCasting â€¢ ffc</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="ffc â€¢ Functional ForeCasting">
<meta name="description" content="Forecast complex, time-changing functional relationships using GAMs. Model functional responses that change over time, not just magnitude.
">
<meta property="og:description" content="Forecast complex, time-changing functional relationships using GAMs. Model functional responses that change over time, not just magnitude.
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">ffc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/mortality-analysis.html">Modeling Mortality Trends with Functional Forecasting</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nicholasjclark/ffc" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="ffc">ffc<a class="anchor" aria-label="anchor" href="#ffc"></a>
</h1></div>
<!-- badges: start -->

</div>
<div class="section level1">
<h1 id="ffc-1">ffc<a class="anchor" aria-label="anchor" href="#ffc-1"></a>
</h1>
<blockquote>
<p><strong>F</strong>unctional <strong>F</strong>ore<strong>C</strong>asting</p>
</blockquote>
<p>The goal of the <code>ffc</code> ðŸ“¦ is to <strong>forecast complex, time-changing functional relationships</strong> using Generalized Additive Models (GAMs).</p>
<p><strong>Key benefits:</strong> - Model functional responses that change shape over time (not just magnitude) - Forecast entire curves into the future, not just single values<br>
- Handle complex multivariate time series with functional structure - Seamless integration with the powerful <a href="https://cran.r-project.org/package=mgcv" class="external-link"><code>mgcv</code></a> and <a href="https://fable.tidyverts.org/" class="external-link"><code>fable</code></a> ecosystems</p>
<p>The package introduces <strong>dynamic functional predictors</strong> using the new <code><a href="reference/fts.html">fts()</a></code> term, which creates time-varying coefficients that can be forecasted using efficient Stan-based algorithms.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of ffc from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"nicholasjclark/ffc"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit a model with time-varying coefficients</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ffc_gam.html">ffc_gam</a></span><span class="op">(</span></span>
<span>  <span class="va">response</span> <span class="op">~</span> <span class="fu"><a href="reference/fts.html">fts</a></span><span class="op">(</span><span class="va">predictor</span>, time_k <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,  </span>
<span>  data <span class="op">=</span> <span class="va">your_data</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"time_column"</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Forecast the functional coefficients</span></span>
<span><span class="va">fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/forecast.html">forecast</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">future_data</span>, model <span class="op">=</span> <span class="st">"ARDF"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="queensland-mortality-analysis">Queensland Mortality Analysis<a class="anchor" aria-label="anchor" href="#queensland-mortality-analysis"></a>
</h3>
<p>The <code>ffc</code> package excels at modeling functional relationships that evolve over time. A detailed case study using Queensland mortality data demonstrates key concepts:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nicholasjclark.github.io/ffc">ffc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"qld_mortality"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">qld_mortality</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    year age    sex deaths population</span></span>
<span><span class="co">#&gt; 1  1980   0 female    190   17699.81</span></span>
<span><span class="co">#&gt; 2  1980   1 female     20   17505.27</span></span>
<span><span class="co">#&gt; 3  1980   2 female      6   17715.56</span></span>
<span><span class="co">#&gt; 4  1980   3 female      6   18080.06</span></span>
<span><span class="co">#&gt; 5  1980   4 female     10   18390.10</span></span>
<span><span class="co">#&gt; 6  1980   5 female      6   18870.54</span></span>
<span><span class="co">#&gt; 7  1980   6 female      1   19641.01</span></span>
<span><span class="co">#&gt; 8  1980   7 female      2   20475.01</span></span>
<span><span class="co">#&gt; 9  1980   8 female      2   21599.01</span></span>
<span><span class="co">#&gt; 10 1980   9 female      7   22170.09</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Preview the functional patterns</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">qld_mortality</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">deaths</span> <span class="op">/</span> <span class="va">population</span>, group <span class="op">=</span> <span class="va">year</span>, colour <span class="op">=</span> <span class="va">year</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Mortality rate"</span>, title <span class="op">=</span> <span class="st">"Evolving mortality patterns over time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="reference/figures/README-mortality-preview-1.png" alt="Preview of Queensland mortality data showing characteristic J-shaped curves that shift systematically over time, demonstrating functional evolution suitable for ffc modeling." width="100%"><p class="caption">
plot of chunk mortality-preview
</p>
</div>
<p><strong>Key features that make this ideal for functional forecasting:</strong> - <strong>J-shaped mortality curves</strong> that evolve smoothly over 40 years - <strong>Hierarchical structure</strong> with sex-specific deviations from shared trends<br>
- <strong>Systematic temporal patterns</strong> suitable for time series forecasting</p>
<blockquote>
<p><strong>ðŸ“– For a comprehensive tutorial</strong> covering model fitting, diagnostics, interpretation, and forecasting, see <code><a href="articles/mortality-analysis.html">vignette("mortality-analysis", package = "ffc")</a></code></p>
</blockquote>
</div>
<div class="section level3">
<h3 id="tourism-forecasting-with-fabletools-integration">Tourism Forecasting with fabletools Integration<a class="anchor" aria-label="anchor" href="#tourism-forecasting-with-fabletools-integration"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fable.tidyverts.org" class="external-link">fable</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tsibble.tidyverts.org" class="external-link">tsibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>Our aim here is to forecast the number of domestic visitors to Melbourne, Australia. The data can be found in the <code><a href="https://tsibble.tidyverts.org/reference/tourism.html" class="external-link">tsibble::tourism</a></code> data set. For now we need to explicitly add the <code>quarter</code> and <code>time</code> variables to the data, but in future this will be done automatically for seamless integration with the <code>tsibbleverse</code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tourism_melb</span> <span class="op">&lt;-</span> <span class="va">tourism</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">Region</span> <span class="op">==</span> <span class="st">"Melbourne"</span>,</span>
<span>    <span class="va">Purpose</span> <span class="op">==</span> <span class="st">"Visiting"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    quarter <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/quarter.html" class="external-link">quarter</a></span><span class="op">(</span><span class="va">Quarter</span><span class="op">)</span>,</span>
<span>    time <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">tourism_melb</span></span>
<span><span class="co">#&gt; # A tsibble: 80 x 7 [1Q]</span></span>
<span><span class="co">#&gt; # Key:       Region, State, Purpose [1]</span></span>
<span><span class="co">#&gt;    Quarter Region    State    Purpose  Trips quarter  time</span></span>
<span><span class="co">#&gt;      &lt;qtr&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt;   &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 1998 Q1 Melbourne Victoria Visiting  666.       1     1</span></span>
<span><span class="co">#&gt;  2 1998 Q2 Melbourne Victoria Visiting  601.       2     2</span></span>
<span><span class="co">#&gt;  3 1998 Q3 Melbourne Victoria Visiting  529.       3     3</span></span>
<span><span class="co">#&gt;  4 1998 Q4 Melbourne Victoria Visiting  575.       4     4</span></span>
<span><span class="co">#&gt;  5 1999 Q1 Melbourne Victoria Visiting  623.       1     5</span></span>
<span><span class="co">#&gt;  6 1999 Q2 Melbourne Victoria Visiting  530.       2     6</span></span>
<span><span class="co">#&gt;  7 1999 Q3 Melbourne Victoria Visiting  479.       3     7</span></span>
<span><span class="co">#&gt;  8 1999 Q4 Melbourne Victoria Visiting  538.       4     8</span></span>
<span><span class="co">#&gt;  9 2000 Q1 Melbourne Victoria Visiting  618.       1     9</span></span>
<span><span class="co">#&gt; 10 2000 Q2 Melbourne Victoria Visiting  549.       2    10</span></span>
<span><span class="co">#&gt; # â„¹ 70 more rows</span></span></code></pre></div>
<p>Split into training and testing folds. We wil aim to forecast the last 5 quarters of the data</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">tourism_melb</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">75</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">tourism_melb</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_tail</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>Now fit an <code>ffc_gam</code>. We use time-varying level and time-varying seasonality components, together with a Tweedie observation model (because our outcome, <code>Trips</code>, consists of non-negative real values). This model is simpler so we use the <code>'gam'</code> engine for fitting:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ffc_gam.html">ffc_gam</a></span><span class="op">(</span></span>
<span>  <span class="va">Trips</span> <span class="op">~</span></span>
<span>    <span class="co"># Use mean_only = TRUE to model a time-varying mean</span></span>
<span>    <span class="fu"><a href="reference/fts.html">fts</a></span><span class="op">(</span></span>
<span>      <span class="va">time</span>,</span>
<span>      mean_only <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      time_k <span class="op">=</span> <span class="fl">50</span>,</span>
<span>      time_m <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># Time-varying seasonality</span></span>
<span>    <span class="fu"><a href="reference/fts.html">fts</a></span><span class="op">(</span></span>
<span>      <span class="va">quarter</span>,</span>
<span>      k <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      time_k <span class="op">=</span> <span class="fl">15</span>,</span>
<span>      time_m <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">train</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="reference/tw.html">tw</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  engine <span class="op">=</span> <span class="st">"gam"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Draw the time-varying basis coefficients, this time using <code>gratia</code></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">gratia</span><span class="fu">::</span><span class="fu"><a href="https://gavinsimpson.github.io/gratia/reference/draw.html" class="external-link">draw</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="reference/figures/README-tourism-coefficients-1.png" alt="Smooth plots showing time-varying coefficients for the tourism model. The upper panel shows the time-varying level component while the lower panel displays seasonal coefficients that change over time, demonstrating how seasonality patterns evolve." width="100%"><p class="caption">
plot of chunk tourism-coefficients
</p>
</div>
<p>Compute forecast distribution by fitting the basis coefficient time series models in parallel (which is automatically supported within the <code>fable</code> package). Here we fit independent exponential smoothing models to each coefficient time series</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/forecast.html">forecast</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">mod</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">test</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"ETS"</span>,</span>
<span>  summary <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Convert resulting forecasts to a <code>fable</code> object for automatic plotting and/or scoring of forecasts</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using the new as_fable method for seamless conversion</span></span>
<span><span class="va">fc_ffc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://fabletools.tidyverts.org/reference/as-fable.html" class="external-link">as_fable</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">test</span>, forecasts <span class="op">=</span> <span class="va">fc</span><span class="op">)</span></span>
<span><span class="va">fc_ffc</span></span>
<span><span class="co">#&gt; # A fable: 5 x 10 [1Q]</span></span>
<span><span class="co">#&gt; # Key:     Region, State, Purpose [1]</span></span>
<span><span class="co">#&gt;   Quarter Region    State   Purpose Trips quarter  time       .dist .mean .model</span></span>
<span><span class="co">#&gt;     &lt;qtr&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;   &lt;int&gt; &lt;int&gt;      &lt;dist&gt; &lt;dbl&gt; &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 2016 Q4 Melbourne Victorâ€¦ Visitiâ€¦  804.       4    76 sample[200]  818. FFC_Aâ€¦</span></span>
<span><span class="co">#&gt; 2 2017 Q1 Melbourne Victorâ€¦ Visitiâ€¦  734.       1    77 sample[200]  759. FFC_Aâ€¦</span></span>
<span><span class="co">#&gt; 3 2017 Q2 Melbourne Victorâ€¦ Visitiâ€¦  670.       2    78 sample[200]  773. FFC_Aâ€¦</span></span>
<span><span class="co">#&gt; 4 2017 Q3 Melbourne Victorâ€¦ Visitiâ€¦  824.       3    79 sample[200]  755. FFC_Aâ€¦</span></span>
<span><span class="co">#&gt; 5 2017 Q4 Melbourne Victorâ€¦ Visitiâ€¦  985.       4    80 sample[200]  858. FFC_Aâ€¦</span></span></code></pre></div>
<p>Leverage the fabletools ecosystem for forecast analysis</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate accuracy metrics</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html" class="external-link">accuracy</a></span><span class="op">(</span><span class="va">fc_ffc</span>, <span class="va">test</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 Ã— 13</span></span>
<span><span class="co">#&gt;   .model    Region State Purpose .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 FFC_ARIMA Melboâ€¦ Victâ€¦ Visitiâ€¦ Test   10.9  80.6  67.7 0.154  8.37   NaN   NaN</span></span>
<span><span class="co">#&gt; # â„¹ 1 more variable: ACF1 &lt;dbl&gt;</span></span>
<span></span>
<span><span class="co"># Generate prediction intervals  </span></span>
<span><span class="va">fc_intervals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/hilo.html" class="external-link">hilo</a></span><span class="op">(</span><span class="va">fc_ffc</span>, level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fc_intervals</span></span>
<span><span class="co">#&gt; # A tsibble: 5 x 12 [1Q]</span></span>
<span><span class="co">#&gt; # Key:       Region, State, Purpose [1]</span></span>
<span><span class="co">#&gt;   Quarter Region    State   Purpose Trips quarter  time       .dist .mean .model</span></span>
<span><span class="co">#&gt;     &lt;qtr&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;   &lt;int&gt; &lt;int&gt;      &lt;dist&gt; &lt;dbl&gt; &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 2016 Q4 Melbourne Victorâ€¦ Visitiâ€¦  804.       4    76 sample[200]  818. FFC_Aâ€¦</span></span>
<span><span class="co">#&gt; 2 2017 Q1 Melbourne Victorâ€¦ Visitiâ€¦  734.       1    77 sample[200]  759. FFC_Aâ€¦</span></span>
<span><span class="co">#&gt; 3 2017 Q2 Melbourne Victorâ€¦ Visitiâ€¦  670.       2    78 sample[200]  773. FFC_Aâ€¦</span></span>
<span><span class="co">#&gt; 4 2017 Q3 Melbourne Victorâ€¦ Visitiâ€¦  824.       3    79 sample[200]  755. FFC_Aâ€¦</span></span>
<span><span class="co">#&gt; 5 2017 Q4 Melbourne Victorâ€¦ Visitiâ€¦  985.       4    80 sample[200]  858. FFC_Aâ€¦</span></span>
<span><span class="co">#&gt; # â„¹ 2 more variables: `80%` &lt;hilo&gt;, `95%` &lt;hilo&gt;</span></span>
<span></span>
<span><span class="co"># Distribution summaries</span></span>
<span><span class="va">fc_summary</span> <span class="op">&lt;-</span> <span class="va">fc_ffc</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    mean_forecast <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.dist</span><span class="op">)</span>,</span>
<span>    median_forecast <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">.dist</span><span class="op">)</span>,</span>
<span>    q25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">.dist</span>, <span class="fl">0.25</span><span class="op">)</span>, </span>
<span>    q75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">.dist</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">fc_summary</span></span>
<span><span class="co">#&gt; # A tsibble: 5 x 5 [1Q]</span></span>
<span><span class="co">#&gt;   Quarter mean_forecast median_forecast   q25   q75</span></span>
<span><span class="co">#&gt;     &lt;qtr&gt;         &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 2016 Q4          818.            822.  770.  869.</span></span>
<span><span class="co">#&gt; 2 2017 Q1          759.            752.  712.  803.</span></span>
<span><span class="co">#&gt; 3 2017 Q2          773.            773.  724.  822.</span></span>
<span><span class="co">#&gt; 4 2017 Q3          755.            758.  702.  797.</span></span>
<span><span class="co">#&gt; 5 2017 Q4          858.            865.  799.  907.</span></span></code></pre></div>
<p>Compare FFC functional forecasting to traditional time series models</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate FFC forecasts with different models</span></span>
<span><span class="va">fc_ffc_arima</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://fabletools.tidyverts.org/reference/as-fable.html" class="external-link">as_fable</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">test</span>, model <span class="op">=</span> <span class="st">"ARIMA"</span><span class="op">)</span></span>
<span><span class="va">fc_ffc_ets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://fabletools.tidyverts.org/reference/as-fable.html" class="external-link">as_fable</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">test</span>, model <span class="op">=</span> <span class="st">"ETS"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate traditional model forecasts</span></span>
<span><span class="va">fc_traditional</span> <span class="op">&lt;-</span> <span class="va">train</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html" class="external-link">model</a></span><span class="op">(</span></span>
<span>    ARIMA <span class="op">=</span> <span class="fu"><a href="https://fable.tidyverts.org/reference/ARIMA.html" class="external-link">ARIMA</a></span><span class="op">(</span><span class="va">Trips</span><span class="op">)</span>,</span>
<span>    ETS <span class="op">=</span> <span class="fu"><a href="https://fable.tidyverts.org/reference/ETS.html" class="external-link">ETS</a></span><span class="op">(</span><span class="va">Trips</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate accuracy for all models</span></span>
<span><span class="va">acc_ffc_arima</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html" class="external-link">accuracy</a></span><span class="op">(</span><span class="va">fc_ffc_arima</span>, <span class="va">test</span><span class="op">)</span></span>
<span><span class="va">acc_ffc_ets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html" class="external-link">accuracy</a></span><span class="op">(</span><span class="va">fc_ffc_ets</span>, <span class="va">test</span><span class="op">)</span></span>
<span><span class="va">acc_traditional</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html" class="external-link">accuracy</a></span><span class="op">(</span><span class="va">fc_traditional</span>, <span class="va">test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract MAPE values for titles</span></span>
<span><span class="va">mape_ffc_arima</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">acc_ffc_arima</span><span class="op">$</span><span class="va">MAPE</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mape_ffc_ets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">acc_ffc_ets</span><span class="op">$</span><span class="va">MAPE</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mape_arima</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">acc_traditional</span><span class="op">$</span><span class="va">MAPE</span><span class="op">[</span><span class="va">acc_traditional</span><span class="op">$</span><span class="va">.model</span> <span class="op">==</span> <span class="st">"ARIMA"</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mape_ets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">acc_traditional</span><span class="op">$</span><span class="va">MAPE</span><span class="op">[</span><span class="va">acc_traditional</span><span class="op">$</span><span class="va">.model</span> <span class="op">==</span> <span class="st">"ETS"</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create comparison plots</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">fc_ffc_arima</span>, <span class="va">train</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">test</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Trips</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"FFC with ARIMA (MAPE: "</span>, <span class="va">mape_ffc_arima</span>, <span class="st">"%)"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">fc_ffc_ets</span>, <span class="va">train</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">test</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Trips</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"FFC with ETS (MAPE: "</span>, <span class="va">mape_ffc_ets</span>, <span class="st">"%)"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fc_traditional</span>, <span class="va">.model</span> <span class="op">==</span> <span class="st">"ARIMA"</span><span class="op">)</span>, <span class="va">train</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">test</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Trips</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Traditional ARIMA (MAPE: "</span>, <span class="va">mape_arima</span>, <span class="st">"%)"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fc_traditional</span>, <span class="va">.model</span> <span class="op">==</span> <span class="st">"ETS"</span><span class="op">)</span>, <span class="va">train</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">test</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Trips</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Traditional ETS (MAPE: "</span>, <span class="va">mape_ets</span>, <span class="st">"%)"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p3</span> <span class="op">|</span> <span class="va">p4</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="reference/figures/README-model-comparison-1.png" alt="Comprehensive model comparison showing FFC functional forecasting versus traditional ARIMA and ETS models for Melbourne tourism data. The plot demonstrates forecast performance with MAPE values in titles, revealing the added value of functional forecasting approaches." width="100%"><p class="caption">
plot of chunk model-comparison
</p>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Display comprehensive accuracy comparison</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">acc_ffc_arima</span>, <span class="va">acc_ffc_ets</span>, <span class="va">acc_traditional</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 Ã— 13</span></span>
<span><span class="co">#&gt;   .model    Region State Purpose .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 FFC_ARIMA Melboâ€¦ Victâ€¦ Visitiâ€¦ Test   38.5  93.6  68.5  3.59  8.03   NaN   NaN</span></span>
<span><span class="co">#&gt; 2 FFC_ETS   Melboâ€¦ Victâ€¦ Visitiâ€¦ Test   20.9  83.7  67.0  1.43  8.16   NaN   NaN</span></span>
<span><span class="co">#&gt; 3 ARIMA     Melboâ€¦ Victâ€¦ Visitiâ€¦ Test   32.4  98.6  84.3  2.62 10.2    NaN   NaN</span></span>
<span><span class="co">#&gt; 4 ETS       Melboâ€¦ Victâ€¦ Visitiâ€¦ Test   48.9 120.   99.8  4.52 11.9    NaN   NaN</span></span>
<span><span class="co">#&gt; # â„¹ 1 more variable: ACF1 &lt;dbl&gt;</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="getting-help">Getting help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h2>
<p>If you encounter a clear bug, please file an issue with a minimal reproducible example on <a href="https://github.com/nicholasjclark/ffc/issues" class="external-link">GitHub</a></p>
</div>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>Contributions are very welcome, but please see our <a href="https://github.com/nicholasjclark/ffc/blob/main/.github/CODE_OF_CONDUCT.md" class="external-link">Code of Conduct</a> when you are considering changes that you would like to make.</p>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>The <code>ffc</code> project is licensed under an <code>MIT</code> open source license</p>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/nicholasjclark/ffc/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/nicholasjclark/ffc/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ffc</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://ecogambler.netlify.app/" class="external-link">Nicholas J Clark</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-7131-3301" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://CRAN.R-project.org/package=ffc" class="external-link"><img src="https://www.r-pkg.org/badges/version/ffc" alt="CRAN status"></a></li>
<li><a href="https://github.com/nicholasjclark/ffc/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/nicholasjclark/ffc/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/nicholasjclark/ffc" class="external-link"><img src="https://codecov.io/gh/nicholasjclark/ffc/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ecogambler.netlify.app/" class="external-link">Nicholas J Clark</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
