<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>ffc â€¢ Functional ForeCasting â€¢ ffc</title>
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="katex-auto.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="ffc â€¢ Functional ForeCasting">
<meta name="description" content="Forecast complex, time-changing functional relationships using GAMs. Model functional responses that change over time, not just magnitude.
">
<meta property="og:description" content="Forecast complex, time-changing functional relationships using GAMs. Model functional responses that change over time, not just magnitude.
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">ffc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/mortality-analysis.html">Modeling Mortality Trends with Functional Forecasting</a></li>
    <li><a class="dropdown-item" href="articles/elnino-forecasting.html">Forecasting El NiÃ±o Patterns with Cyclic Splines and Dynamic Factor Models</a></li>
    <li><a class="dropdown-item" href="articles/distributional-regression.html">Distributional Regression for Motorcycle Crash Data with Time-Varying Location and Scale Parameters</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nicholasjclark/ffc" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="ffc">ffc<a class="anchor" aria-label="anchor" href="#ffc"></a>
</h1></div>
<blockquote>
<p><strong>F</strong>unctional <strong>F</strong>ore<strong>C</strong>asting</p>
</blockquote>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a> <a href="https://CRAN.R-project.org/package=ffc" class="external-link"><img src="https://www.r-pkg.org/badges/version/ffc" alt="CRAN status"></a> <a href="https://github.com/nicholasjclark/ffc/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/nicholasjclark/ffc/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a> <a href="https://app.codecov.io/gh/nicholasjclark/ffc" class="external-link"><img src="https://codecov.io/gh/nicholasjclark/ffc/graph/badge.svg" alt="Codecov test coverage"></a></p>
<p>The goal of the <code>ffc</code> ðŸ“¦ is to forecast complex, time-changing functional relationships by integrating Generalized Additive Models with dynamic factor functional basis expansions.</p>
<p><strong>Key benefits:</strong></p>
<ul>
<li>Model functional responses that change shape over time (not just magnitude)<br>
</li>
<li>Forecast entire curves into the future, not just single values<br>
</li>
<li>Handle complex multivariate time series with functional structure<br>
</li>
<li>Seamless integration with the powerful <a href="https://cran.r-project.org/package=mgcv" class="external-link"><code>mgcv</code></a> and <a href="https://fable.tidyverts.org/" class="external-link"><code>fable</code></a> ecosystems</li>
</ul>
<p>The package introduces dynamic functional predictors using the new <code><a href="reference/fts.html">fts()</a></code> term, which decomposes functional time series into time-varying basis coefficients that can be forecasted using either independent time series models from the <code>fable</code> package or with efficient dynamic factor models using precompiled Stan models.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of <code>ffc</code> from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># install.packages("pak")</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>pak<span class="sc">::</span><span class="fu">pak</span>(<span class="st">"nicholasjclark/ffc"</span>)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(ffc)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co"># Fit a model with time-varying coefficients</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">ffc_gam</span>(</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  response <span class="sc">~</span> <span class="fu">fts</span>(predictor, <span class="at">time_k =</span> <span class="dv">10</span>),  </span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="at">data =</span> your_data,</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  <span class="at">time =</span> <span class="st">"time_column"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>()</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co"># Forecast the functional coefficients</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>fc <span class="ot">&lt;-</span> <span class="fu">forecast</span>(mod, <span class="at">newdata =</span> future_data, <span class="at">model =</span> <span class="st">"ARDF"</span>)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="tourism-forecasting-with-fabletools-integration">Tourism Forecasting with <code>fabletools</code> Integration<a class="anchor" aria-label="anchor" href="#tourism-forecasting-with-fabletools-integration"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(fable)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">library</span>(tsibble)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="fu">library</span>(ggplot2); <span class="fu">theme_set</span>(<span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>))</span></code></pre></div>
<p>Our aim here is to forecast the number of domestic visitors to Melbourne, Australia. The data can be found in the <code><a href="https://tsibble.tidyverts.org/reference/tourism.html" class="external-link">tsibble::tourism</a></code> data set. For now we need to explicitly add the <code>quarter</code> and <code>time</code> variables to the data, but in future this will be done automatically for seamless integration with the <a href="https://tsibble.tidyverts.org/" class="external-link"><code>tsibbleverse</code></a></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>tourism_melb <span class="ot">&lt;-</span> tourism <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    Region <span class="sc">==</span> <span class="st">"Melbourne"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    Purpose <span class="sc">==</span> <span class="st">"Visiting"</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="at">quarter =</span> lubridate<span class="sc">::</span><span class="fu">quarter</span>(Quarter),</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="at">time =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  )</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>tourism_melb</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; # A tsibble: 80 x 7 [1Q]</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; # Key:       Region, State, Purpose [1]</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt;    Quarter Region    State    Purpose  Trips quarter  time</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt;      &lt;qtr&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt;   &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt;  1 1998 Q1 Melbourne Victoria Visiting  666.       1     1</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt;  2 1998 Q2 Melbourne Victoria Visiting  601.       2     2</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt;  3 1998 Q3 Melbourne Victoria Visiting  529.       3     3</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt;  4 1998 Q4 Melbourne Victoria Visiting  575.       4     4</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt;  5 1999 Q1 Melbourne Victoria Visiting  623.       1     5</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt;  6 1999 Q2 Melbourne Victoria Visiting  530.       2     6</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt;  7 1999 Q3 Melbourne Victoria Visiting  479.       3     7</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt;  8 1999 Q4 Melbourne Victoria Visiting  538.       4     8</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co">#&gt;  9 2000 Q1 Melbourne Victoria Visiting  618.       1     9</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="co">#&gt; 10 2000 Q2 Melbourne Victoria Visiting  549.       2    10</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="co">#&gt; # â„¹ 70 more rows</span></span></code></pre></div>
<p>Split into training and testing folds. We wil aim to forecast the last 5 quarters of the data</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>train <span class="ot">&lt;-</span> tourism_melb <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">75</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>test <span class="ot">&lt;-</span> tourism_melb <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code></pre></div>
<p>Now fit an <code>ffc_gam</code>. We use time-varying level and time-varying seasonality components, together with a Tweedie observation model (because our outcome, <code>Trips</code>, consists of non-negative real values). This model is simpler so we use the <code>'gam'</code> engine for fitting:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">ffc_gam</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  Trips <span class="sc">~</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="co"># Use mean_only = TRUE to model a time-varying mean</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    <span class="fu">fts</span>(</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>      time,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>      <span class="at">mean_only =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>      <span class="at">time_k =</span> <span class="dv">50</span>,</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>      <span class="at">time_m =</span> <span class="dv">1</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    <span class="co"># Time-varying seasonality</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>    <span class="fu">fts</span>(</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>      quarter,</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>      <span class="at">k =</span> <span class="dv">4</span>,</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>      <span class="at">time_k =</span> <span class="dv">15</span>,</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>      <span class="at">time_m =</span> <span class="dv">1</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>    ),</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>  <span class="at">time =</span> <span class="st">"time"</span>,</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>  <span class="at">data =</span> train,</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">tw</span>(),</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>  <span class="at">engine =</span> <span class="st">"gam"</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>)</span></code></pre></div>
<p>The <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code> method is handy for viewing the time-varying basis coefficients from <code><a href="reference/ffc_gam.html">ffc_gam()</a></code> models. Here we draw 10 realisations from the estimated coefficient distributions and plot them.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">fts_coefs</span>(mod, <span class="at">times =</span> <span class="dv">10</span>, <span class="at">summary =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code></pre></div>
<p><img src="reference/figures/README-tourism-coefficients0-1.png" alt="autplot() plots showing time-varying coefficients for the tourism model, illustrating how basis coefficients have been estimated to vary through time." width="100%"></p>
<p>We can also draw the time-varying basis coefficients using support from the <a href="https://gavinsimpson.github.io/gratia/" class="external-link"><code>gratia</code></a> package, which has helpful functions for plotting smooth effects:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>gratia<span class="sc">::</span><span class="fu">draw</span>(mod)</span></code></pre></div>
<p><img src="reference/figures/README-tourism-coefficients-1.png" alt="Smooth plots showing time-varying coefficients for the tourism model. The upper panel shows the time-varying level component while the lower panel displays seasonal coefficients that change over time, demonstrating how seasonality patterns evolve." width="100%"></p>
<p>These plots show the time-varying <em>coefficients</em> for a set of basis functions. We have one function representing the mean of the series (essentially a constant) as well as three basis functions representing the quarterly seasonality. Each of these has a coefficient that can change through time, allowing the entire functional series to change shape over time. We can compute forecast distribution by fitting the basis coefficient forecast models in parallel (which is automatically supported within the <code>fable</code> package). Here we fit independent exponential smoothing models to each coefficient time series</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>fc <span class="ot">&lt;-</span> <span class="fu">forecast</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="at">object =</span> mod,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="at">newdata =</span> test,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"ETS"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="at">summary =</span> <span class="cn">FALSE</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>)</span></code></pre></div>
<p>We can also convert resulting forecasts to a <code>fable</code> object for automatic plotting and/or scoring of forecasts</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Using the new as_fable method for seamless conversion</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>fc_ffc <span class="ot">&lt;-</span> <span class="fu">as_fable</span>(mod, <span class="at">newdata =</span> test, <span class="at">forecasts =</span> fc)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>fc_ffc</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt; # A fable: 5 x 10 [1Q]</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; # Key:     Region, State, Purpose [1]</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt;   Quarter Region    State   Purpose Trips quarter  time       .dist .mean .model</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt;     &lt;qtr&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;   &lt;int&gt; &lt;int&gt;      &lt;dist&gt; &lt;dbl&gt; &lt;chr&gt; </span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; 1 2016 Q4 Melbourne Victorâ€¦ Visitiâ€¦  804.       4    76 sample[200]  834. FFC_Eâ€¦</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; 2 2017 Q1 Melbourne Victorâ€¦ Visitiâ€¦  734.       1    77 sample[200]  766. FFC_Eâ€¦</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; 3 2017 Q2 Melbourne Victorâ€¦ Visitiâ€¦  670.       2    78 sample[200]  760. FFC_Eâ€¦</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; 4 2017 Q3 Melbourne Victorâ€¦ Visitiâ€¦  824.       3    79 sample[200]  740. FFC_Eâ€¦</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; 5 2017 Q4 Melbourne Victorâ€¦ Visitiâ€¦  985.       4    80 sample[200]  827. FFC_Eâ€¦</span></span></code></pre></div>
<p>Leverage the fabletools ecosystem for forecast analysis</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Calculate accuracy metrics</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">accuracy</span>(fc_ffc, test)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 Ã— 13</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt;   .model  Region   State Purpose .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt; 1 FFC_ETS Melbourâ€¦ Victâ€¦ Visitiâ€¦ Test   17.9  91.7  78.8 0.921  9.55   NaN   NaN</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt; # â„¹ 1 more variable: ACF1 &lt;dbl&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co"># Generate prediction intervals  </span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>fc_intervals <span class="ot">&lt;-</span> <span class="fu">hilo</span>(fc_ffc, <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">95</span>))</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>fc_intervals</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; # A tsibble: 5 x 12 [1Q]</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt; # Key:       Region, State, Purpose [1]</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt;   Quarter Region    State   Purpose Trips quarter  time       .dist .mean .model</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt;     &lt;qtr&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;   &lt;int&gt; &lt;int&gt;      &lt;dist&gt; &lt;dbl&gt; &lt;chr&gt; </span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt; 1 2016 Q4 Melbourne Victorâ€¦ Visitiâ€¦  804.       4    76 sample[200]  834. FFC_Eâ€¦</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt; 2 2017 Q1 Melbourne Victorâ€¦ Visitiâ€¦  734.       1    77 sample[200]  766. FFC_Eâ€¦</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; 3 2017 Q2 Melbourne Victorâ€¦ Visitiâ€¦  670.       2    78 sample[200]  760. FFC_Eâ€¦</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">#&gt; 4 2017 Q3 Melbourne Victorâ€¦ Visitiâ€¦  824.       3    79 sample[200]  740. FFC_Eâ€¦</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="co">#&gt; 5 2017 Q4 Melbourne Victorâ€¦ Visitiâ€¦  985.       4    80 sample[200]  827. FFC_Eâ€¦</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="co">#&gt; # â„¹ 2 more variables: `80%` &lt;hilo&gt;, `95%` &lt;hilo&gt;</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a><span class="co"># Distribution summaries</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>fc_summary <span class="ot">&lt;-</span> fc_ffc <span class="sc">|&gt;</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a>    <span class="at">mean_forecast =</span> <span class="fu">mean</span>(.dist),</span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a>    <span class="at">median_forecast =</span> <span class="fu">median</span>(.dist),</span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a>    <span class="at">q25 =</span> <span class="fu">quantile</span>(.dist, <span class="fl">0.25</span>), </span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a>    <span class="at">q75 =</span> <span class="fu">quantile</span>(.dist, <span class="fl">0.75</span>)</span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a>  )</span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a>fc_summary</span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a><span class="co">#&gt; # A tsibble: 5 x 5 [1Q]</span></span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a><span class="co">#&gt;   Quarter mean_forecast median_forecast   q25   q75</span></span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a><span class="co">#&gt;     &lt;qtr&gt;         &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a><span class="co">#&gt; 1 2016 Q4          834.            831.  781.  889.</span></span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a><span class="co">#&gt; 2 2017 Q1          766.            762.  714.  820.</span></span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a><span class="co">#&gt; 3 2017 Q2          760.            760.  711.  800.</span></span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a><span class="co">#&gt; 4 2017 Q3          740.            746.  693.  788.</span></span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a><span class="co">#&gt; 5 2017 Q4          827.            830.  770.  875.</span></span></code></pre></div>
<p>Next we can explore how to compare forecasts from <code>ffc</code> models to traditional time series models by again leveraging the simplicity and power of the <code>fable</code> ecosystem</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Generate FFC forecasts with different models</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>fc_ffc_arima <span class="ot">&lt;-</span> <span class="fu">as_fable</span>(mod, <span class="at">newdata =</span> test, <span class="at">model =</span> <span class="st">"ARIMA"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>fc_ffc_ets <span class="ot">&lt;-</span> <span class="fu">as_fable</span>(mod, <span class="at">newdata =</span> test, <span class="at">model =</span> <span class="st">"ETS"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co"># Generate traditional model forecasts</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>fc_traditional <span class="ot">&lt;-</span> train <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>    <span class="at">ARIMA =</span> <span class="fu">ARIMA</span>(Trips),</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>    <span class="at">ETS =</span> <span class="fu">ETS</span>(Trips)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">5</span>)</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co"># Calculate accuracy for all models</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>acc_ffc_arima <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(fc_ffc_arima, test)</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>acc_ffc_ets <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(fc_ffc_ets, test)</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>acc_traditional <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(fc_traditional, test)</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co"># Extract MAPE values for titles</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>mape_ffc_arima <span class="ot">&lt;-</span> <span class="fu">round</span>(acc_ffc_arima<span class="sc">$</span>MAPE, <span class="dv">1</span>)</span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>mape_ffc_ets <span class="ot">&lt;-</span> <span class="fu">round</span>(acc_ffc_ets<span class="sc">$</span>MAPE, <span class="dv">1</span>)</span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>mape_arima <span class="ot">&lt;-</span> <span class="fu">round</span>(acc_traditional<span class="sc">$</span>MAPE[acc_traditional<span class="sc">$</span>.model <span class="sc">==</span> <span class="st">"ARIMA"</span>], <span class="dv">1</span>)</span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a>mape_ets <span class="ot">&lt;-</span> <span class="fu">round</span>(acc_traditional<span class="sc">$</span>MAPE[acc_traditional<span class="sc">$</span>.model <span class="sc">==</span> <span class="st">"ETS"</span>], <span class="dv">1</span>)</span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a><span class="co"># Create comparison plots</span></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fc_ffc_arima, train) <span class="sc">+</span> </span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> test, <span class="fu">aes</span>(<span class="at">y =</span> Trips), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">"FFC with ARIMA (MAPE: "</span>, mape_ffc_arima, <span class="st">"%)"</span>))</span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fc_ffc_ets, train) <span class="sc">+</span> </span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> test, <span class="fu">aes</span>(<span class="at">y =</span> Trips), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">"FFC with ETS (MAPE: "</span>, mape_ffc_ets, <span class="st">"%)"</span>))</span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(<span class="fu">filter</span>(fc_traditional, .model <span class="sc">==</span> <span class="st">"ARIMA"</span>), train) <span class="sc">+</span></span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> test, <span class="fu">aes</span>(<span class="at">y =</span> Trips), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">"Traditional ARIMA (MAPE: "</span>, mape_arima, <span class="st">"%)"</span>))</span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(<span class="fu">filter</span>(fc_traditional, .model <span class="sc">==</span> <span class="st">"ETS"</span>), train) <span class="sc">+</span></span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> test, <span class="fu">aes</span>(<span class="at">y =</span> Trips), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">"Traditional ETS (MAPE: "</span>, mape_ets, <span class="st">"%)"</span>))</span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a></span>
<span id="cb12-43"><a href="#cb12-43" tabindex="-1"></a>(p1 <span class="sc">|</span> p2) <span class="sc">/</span> (p3 <span class="sc">|</span> p4)</span></code></pre></div>
<p><img src="reference/figures/README-model-comparison-1.png" alt="Comprehensive model comparison showing FFC functional forecasting versus traditional ARIMA and ETS models for Melbourne tourism data. The plot demonstrates forecast performance with MAPE values in titles, revealing the added value of functional forecasting approaches." width="100%"></p>
<p>These plots illustrate how the <code>ffc</code> models outperform traditional forecasting models for this forecasting experiment by thinking about this as a functional time series problem.</p>
</div>
</div>
<div class="section level2">
<h2 id="getting-help">Getting help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h2>
<p>If you encounter a clear bug, please file an issue with a minimal reproducible example on <a href="https://github.com/nicholasjclark/ffc/issues" class="external-link">GitHub</a></p>
</div>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>Contributions are very welcome, but please see our <a href="https://github.com/nicholasjclark/ffc/blob/main/.github/CODE_OF_CONDUCT.md" class="external-link">Code of Conduct</a> when you are considering changes that you would like to make.</p>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>The <code>ffc</code> project is licensed under an <code>MIT</code> open source license</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/nicholasjclark/ffc/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/nicholasjclark/ffc/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ffc</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://ecogambler.netlify.app/" class="external-link">Nicholas J Clark</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-7131-3301" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ecogambler.netlify.app/" class="external-link">Nicholas J Clark</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
